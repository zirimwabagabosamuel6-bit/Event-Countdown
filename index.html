<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Maxwell Events â€” 2025â€“2026</title>
    <style>
      :root {
        --bg: #07131a;
        --panel-width: 320px;
        --accent: #ffd24a;
        --accent-text: #072238;
        --muted: #a6c7d9;
        --card-radius: 12px;
        --glass: rgba(255, 255, 255, 0.06);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: linear-gradient(180deg, #041018 0%, #07131a 100%);
        color: #e6f0fb;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        padding: 18px;
      }

      /* HEADER / HERO */
      .hero {
        max-width: 1200px;
        margin: 0 auto 18px;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        height: 360px;
        box-shadow: 0 18px 60px rgba(2, 8, 23, 0.5);
      }
      .hero__img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        object-position: center center;
        transition: transform 0.9s cubic-bezier(0.2, 0.9, 0.2, 1);
        filter: saturate(0.98) contrast(0.95);
      }
      @media (min-width: 1000px) {
        .hero__img {
          object-position: center top;
          transform: scale(1.03);
        }
      }
      .hero__overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 34%,
          rgba(0, 0, 0, 0.82) 100%
        );
        pointer-events: none;
      }
      .hero__content {
        position: absolute;
        left: 22px;
        right: 22px;
        bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 12px;
        z-index: 2;
      }
      .hero h1 {
        margin: 0;
        color: #fff;
        font-size: 1.5rem;
        letter-spacing: 0.3px;
        font-weight: 900;
        text-shadow: 0 8px 26px rgba(0, 0, 0, 0.55);
      }
      .hero .sub {
        color: rgba(255, 255, 255, 0.95);
        font-weight: 600;
        font-size: 0.95rem;
      }

      /* layout & nav */
      .nav {
        max-width: 1200px;
        margin: 12px auto;
        display: flex;
        gap: 12px;
        justify-content: center;
        align-items: center;
      }
      .nav button {
        background: transparent;
        border: 0;
        color: var(--muted);
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.18s;
      }
      .nav button:hover {
        transform: translateY(-2px);
        color: #fff;
      }
      .nav button.active {
        background: linear-gradient(90deg, var(--accent), #ffecb5);
        color: var(--accent-text);
        box-shadow: 0 10px 32px rgba(0, 0, 0, 0.35);
      }

      /* main & top controls */
      .wrap {
        max-width: 1200px;
        margin: 12px auto 120px;
        padding: 0 12px;
      }
      .top-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      .left-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      input[type="search"],
      select {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(255, 255, 255, 0.96);
        color: #072238;
      }
      .view-btn {
        padding: 8px 12px;
        border-radius: 10px;
        border: none;
        background: var(--glass);
        color: #e6f0fb;
        cursor: pointer;
        font-weight: 700;
      }
      .view-btn.primary {
        background: linear-gradient(90deg, var(--accent), #ffecb5);
        color: var(--accent-text);
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.25);
      }

      /* year progress */
      .year-progress {
        height: 8px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 999px;
        width: 100%;
        margin-top: 8px;
        overflow: hidden;
      }
      .year-progress > i {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--accent), #ffb84d);
        transition: width 0.6s;
      }

      /* GRID */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 18px;
        align-items: start;
      }
      .month-heading {
        grid-column: 1/-1;
        color: #eaf6ff;
        font-weight: 900;
        font-size: 1rem;
        padding: 6px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        cursor: pointer;
      }

      .card {
        background: linear-gradient(180deg, #ffffff, #fafbff);
        color: #072238;
        border-radius: var(--card-radius);
        padding: 16px;
        position: relative;
        min-height: 170px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        box-shadow: 0 12px 36px rgba(2, 8, 23, 0.08);
        transition: transform 0.18s, box-shadow 0.18s, filter 0.18s,
          opacity 0.18s;
      }
      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 24px 60px rgba(2, 8, 23, 0.16);
      }

      .month-strip {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 6px;
        border-top-left-radius: var(--card-radius);
        border-bottom-left-radius: var(--card-radius);
      }

      .card .pin {
        position: absolute;
        right: 12px;
        top: 12px;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: 0;
        background: rgba(7, 18, 43, 0.04);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }
      .card .pin.active {
        background: linear-gradient(90deg, #ffd24a, #ffecb5);
        box-shadow: 0 8px 20px rgba(255, 180, 60, 0.12);
      }

      .card .title {
        font-weight: 800;
        font-size: 18px;
        min-height: 48px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .card .title .icon {
        font-size: 20px;
        filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.08));
      }
      .card .meta {
        font-size: 13px;
        color: #28506b;
        min-height: 18px;
      }
      .card .count {
        font-weight: 800;
        color: var(--accent);
        font-size: 15px;
        min-height: 22px;
      }
      .card .status {
        font-weight: 600;
        color: #16344f;
        font-size: 13px;
        min-height: 20px;
      }
      .card .date-badge {
        align-self: flex-start;
        padding: 6px 8px;
        border-radius: 9px;
        background: rgba(7, 18, 43, 0.04);
        font-weight: 800;
      }

      .card.finished {
        opacity: 0.64;
        filter: grayscale(40%);
        transform: none;
        box-shadow: 0 6px 20px rgba(2, 8, 23, 0.05);
      }
      .card.happening {
        box-shadow: 0 20px 60px rgba(255, 90, 70, 0.12);
        animation: pulse 2.6s infinite;
      }
      @keyframes pulse {
        0% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-3px);
        }
        100% {
          transform: translateY(0);
        }
      }

      /* big icon badge to the right for visual */
      .card .big-badge {
        position: absolute;
        right: -8px;
        top: -6px;
        font-size: 60px;
        color: rgba(7, 18, 43, 0.06);
        font-weight: 900;
        pointer-events: none;
      }

      /* GALLERY (museum) - squared tiles */
      .gallery {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }
      .gallery .section-heading {
        color: #eaf6ff;
        font-weight: 900;
        font-size: 1rem;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      }
      .tiles {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
      }
      .tile {
        background: #ddd;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        position: relative;
        aspect-ratio: 1 / 1; /* ensures square tiles */
        display: flex;
        align-items: flex-end;
        justify-content: center;
        transition: transform 0.22s, box-shadow 0.22s;
        box-shadow: 0 8px 18px rgba(2, 8, 23, 0.08);
      }
      .tile img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .tile .cap {
        position: absolute;
        left: 8px;
        bottom: 8px;
        background: rgba(0, 0, 0, 0.42);
        color: #fff;
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 12px;
      }
      .tile:focus,
      .tile:hover {
        transform: translateY(-6px);
        box-shadow: 0 22px 60px rgba(2, 8, 23, 0.16);
      }

      /* LIGHTBOX */
      .lightbox {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 2200;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.85);
      }
      .lightbox.open {
        display: flex;
      }
      .lightbox img {
        max-width: 92%;
        max-height: 82%;
        border-radius: 10px;
      }
      .lightbox .caption {
        color: #fff;
        margin-top: 12px;
        font-weight: 700;
        text-align: center;
      }
      .lightbox .controls {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 26px;
        pointer-events: none;
      }
      .lightbox button {
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.06);
        border: 0;
        color: #fff;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* BIRTHDAYS */
      .birth-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
      }
      .birth-card {
        background: linear-gradient(180deg, #ffffff, #fbfdff);
        color: #072238;
        border-radius: 12px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: flex-start;
        min-height: 110px;
        box-shadow: 0 10px 30px rgba(2, 8, 23, 0.06);
      }
      .birth-card .name {
        font-weight: 900;
        font-size: 16px;
      }
      .birth-card .when {
        font-size: 13px;
        color: #2a3b57;
      }
      .birth-card .countdown {
        font-weight: 800;
        color: var(--accent);
      }

      /* BIRTHDAY POPUP overlay element (centered white box) */
      .bd-popup {
        position: fixed;
        left: 50%;
        top: 30%;
        transform: translate(-50%, -50%) scale(0.98);
        background: #fff;
        color: #072238;
        padding: 18px 22px;
        border-radius: 12px;
        z-index: 3000;
        box-shadow: 0 24px 80px rgba(2, 8, 23, 0.45);
        min-width: 320px;
        max-width: 90%;
        text-align: center;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        animation: bdIn 0.45s cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      .bd-popup.show {
        display: flex;
      }
      .bd-popup h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 900;
      }
      .bd-popup p {
        margin-top: 6px;
        color: #28506b;
        font-weight: 700;
      }

      @keyframes bdIn {
        0% {
          transform: translate(-50%, -60%) scale(0.96);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }
      @keyframes shake {
        0% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-6px);
        }
        40% {
          transform: translateX(6px);
        }
        60% {
          transform: translateX(-4px);
        }
        80% {
          transform: translateX(4px);
        }
        100% {
          transform: translateX(0);
        }
      }
      .bd-popup.shake {
        animation: bdIn 0.45s cubic-bezier(0.2, 0.9, 0.2, 1),
          shake 0.75s ease-in-out 1;
      }

      /* PRESENT mode */
      .present-stage {
        display: flex;
        gap: 18px;
        flex-wrap: nowrap;
        overflow: hidden;
        align-items: center;
        justify-content: center;
        height: 60vh;
      }
      .present-card {
        width: 760px;
        min-width: 480px;
        border-radius: 14px;
        background: linear-gradient(180deg, #ffffff, #fcfdff);
        color: #072238;
        padding: 32px;
        box-shadow: 0 30px 90px rgba(2, 8, 23, 0.32);
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }
      .present-controls {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
      }

      /* pinned panel (right) */
      .pinned-panel {
        position: fixed;
        right: 18px;
        top: 110px;
        width: var(--panel-width);
        max-height: calc(100vh - 140px);
        overflow: auto;
        background: #fff;
        color: #072238;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 24px 80px rgba(2, 8, 23, 0.18);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        gap: 12px;
        transition: transform 0.28s, opacity 0.28s;
      }
      .pinned-panel.hidden {
        transform: translateX(18px);
        opacity: 0;
        pointer-events: none;
      }
      .pinned-panel h3 {
        margin: 0;
        font-size: 14px;
      }
      .pinned-item {
        background: linear-gradient(180deg, #fff, #fafbf7);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        box-shadow: 0 8px 20px rgba(2, 8, 23, 0.06);
      }
      .pinned-controls {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
      }
      .pinned-toggle {
        position: fixed;
        right: 18px;
        top: 64%;
        transform: translateY(-50%);
        width: 56px;
        height: 56px;
        border-radius: 999px;
        border: 0;
        background: linear-gradient(180deg, var(--accent), #ffecb5);
        box-shadow: 0 16px 48px rgba(0, 0, 0, 0.24);
        cursor: pointer;
        font-weight: 900;
        z-index: 2100;
      }
      .pinned-toggle.hidden {
        display: none;
      }

      /* misc small */
      .muted {
        color: rgba(2, 8, 23, 0.5);
      }
      .sr-only {
        position: absolute;
        left: -9999px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }

      @media (max-width: 900px) {
        .hero {
          height: 220px;
        }
        .hero__content {
          left: 12px;
          right: 12px;
          bottom: 12px;
        }
        .present-card {
          width: 92%;
          min-width: unset;
        }
        .pinned-panel {
          left: 12px;
          right: 12px;
          bottom: 18px;
          top: auto;
          width: auto;
          max-height: 120px;
          flex-direction: row;
          gap: 8px;
          padding: 8px;
        }
        .pinned-toggle {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- HERO with supplied image (top-focused crop on desktop) -->
    <header class="hero" role="banner" aria-label="Hero banner">
      <img
        id="heroImg"
        class="hero__img"
        alt="Maxwell banner"
        src="https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/04/VideoCover-1.jpeg?resize=767%2C500&ssl=1"
      />
      <div class="hero__overlay"></div>
      <div class="hero__content">
        <div>
          <h1>Maxwell Events Countdown</h1>
          <div class="sub">2025â€“2026 schedule</div>
          <div
            class="year-progress"
            aria-hidden="true"
            style="width: 280px; margin-top: 8px"
          >
            <i id="yearProgress" style="width: 0%"></i>
          </div>
        </div>
        <div style="text-align: right; color: #fff; font-weight: 700">
          Maxwell â€¢ 2025â€“26
        </div>
      </div>
    </header>

    <!-- NAV -->
    <nav class="nav" role="navigation" aria-label="Main">
      <button id="tabGrid" class="active" aria-pressed="true">Grid</button>
      <button id="tabGallery">Museum (Gallery)</button>
      <button id="tabBirthdays">Birthdays</button>
      <button id="tabPresent">Present</button>
    </nav>

    <!-- top controls -->
    <div class="wrap">
      <div class="top-controls">
        <div class="left-controls">
          <input
            id="search"
            type="search"
            placeholder="Search events..."
            aria-label="Search events"
          />
          <select id="monthFilter" aria-label="Filter month">
            <option value="">All months</option>
            <option value="01">January</option>
            <option value="02">February</option>
            <option value="03">March</option>
            <option value="04">April</option>
            <option value="05">May</option>
            <option value="06">June</option>
            <option value="07">July</option>
            <option value="08">August</option>
            <option value="09">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
          <button id="btnGrid" class="view-btn primary">Grid</button>
          <button id="btnGallery" class="view-btn">Museum</button>
          <button id="btnBirths" class="view-btn">Birthdays</button>
          <button id="btnPresent" class="view-btn">Present</button>
        </div>
        <div style="min-width: 240px; text-align: right">
          <div style="font-weight: 700; color: #fff">Quick Tips</div>
          <div style="font-size: 12px; color: rgba(255, 255, 255, 0.8)">
            Pin events with ðŸ“Œ â€” open gallery images to fullscreen â€” press
            <strong>P</strong> to toggle pinned panel
          </div>
        </div>
      </div>

      <!-- Pinned toggle & panel -->
      <button
        id="pinnedToggle"
        class="pinned-toggle hidden"
        title="Open pinned panel"
      >
        ðŸ“Œ
      </button>
      <aside
        id="pinnedPanel"
        class="pinned-panel hidden"
        aria-label="Pinned events"
        aria-hidden="true"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3>Pinned</h3>
          <div class="pinned-controls">
            <button id="exportPins" class="view-btn" title="Export">
              Export
            </button>
            <button id="clearPins" class="view-btn" title="Clear pins">
              Clear Pins
            </button>
            <button id="hidePins" class="view-btn" title="Hide">Hide</button>
          </div>
        </div>
        <div
          id="pinnedList"
          style="display: flex; flex-direction: column; gap: 10px"
        ></div>
      </aside>

      <!-- SECTIONS -->
      <!-- GRID -->
      <section
        id="sectionGrid"
        class="section active-section"
        aria-label="Grid"
      >
        <div id="eventsContainer" class="grid" aria-live="polite"></div>
      </section>

      <!-- GALLERY / MUSEUM -->
      <section
        id="sectionGallery"
        class="section"
        aria-label="Gallery"
        style="display: none"
      >
        <div class="gallery">
          <div>
            <div class="section-heading">Campus</div>
            <div id="campusTiles" class="tiles"></div>
          </div>
          <div>
            <div class="section-heading">Monthly gallery</div>
            <div id="monthlyTiles" class="tiles"></div>
          </div>
        </div>
      </section>

      <!-- BIRTHDAYS -->
      <section
        id="sectionBirthdays"
        class="section"
        aria-label="Birthdays"
        style="display: none"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <div style="font-weight: 900">Birthdays</div>
          <div class="muted">
            These are read-only (not clickable). Times show time until next
            birthday (resets yearly) or time since last.
          </div>
        </div>
        <div id="birthdaysGrid" class="birth-grid" aria-live="polite"></div>
      </section>

      <!-- PRESENT -->
      <section
        id="sectionPresent"
        class="section"
        aria-label="Present"
        style="display: none"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <div style="font-weight: 900">Present Mode</div>
          <div>
            <button id="enterFs" class="view-btn">Enter Fullscreen</button>
            <button id="pauseSlideshow" class="view-btn">Pause</button>
          </div>
        </div>
        <div
          id="presentStage"
          class="present-stage"
          role="region"
          aria-live="polite"
        ></div>
      </section>
    </div>

    <!-- LIGHTBOX -->
    <div
      id="lightbox"
      class="lightbox"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="controls" style="pointer-events: none">
        <button id="lbPrev" style="pointer-events: auto">â—€</button>
        <button id="lbNext" style="pointer-events: auto">â–¶</button>
      </div>
      <div style="text-align: center">
        <img id="lbImg" alt="" />
        <div id="lbCap" class="caption"></div>
        <div style="margin-top: 12px">
          <button id="lbClose" class="view-btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Birthday popups and confetti canvas -->
    <div
      id="bdPopup"
      class="bd-popup"
      role="status"
      aria-live="assertive"
      aria-hidden="true"
    >
      <h2 id="bdName">Happy Birthday</h2>
      <p id="bdLine">ðŸŽ‰ Happy Birthday! ðŸŽ‰</p>
    </div>
    <canvas
      id="confetti"
      style="
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2999;
      "
    ></canvas>

    <script>
      /* -------------------------
   Data (events / gallery / birthdays)
   ------------------------- */
      const EVENTS = [
        { name: "Summer Holiday", start: "2025-08-01", end: "2025-08-09" },
        {
          name: "School Opening (Arrival & Dorm Move-in)",
          start: "2025-08-10",
          end: "2025-08-11",
        },
        { name: "First Semester Registration", start: "2025-08-11" },
        { name: "Orientation", start: "2025-08-12" },
        { name: "Faculty Family", start: "2025-09-07" },
        { name: "Picture Day", start: "2025-09-09" },
        { name: "Open Weekend", start: "2025-09-12", end: "2025-09-14" },
        { name: "Week of Prayer", start: "2025-09-15", end: "2025-09-20" },
        { name: "Camping Trip", start: "2025-09-21", end: "2025-09-23" },
        { name: "Online Parent-Teacher Conferences", start: "2025-09-30" },
        { name: "Midterm Break", start: "2025-10-09", end: "2025-10-20" },
        { name: "Music Sabbath", start: "2025-10-25" },
        {
          name: "Weekend of Spiritual Emphasis",
          start: "2025-11-07",
          end: "2025-11-08",
        },
        { name: "MAP Testing", start: "2025-11-24", end: "2025-11-27" },
        { name: "Faculty Family", start: "2025-11-14" },
        { name: "Finals Review Week", start: "2025-12-01", end: "2025-12-05" },
        { name: "Final Exams 1st Sem", start: "2025-12-08", end: "2025-12-10" },
        { name: "Christmas Break", start: "2025-12-10", end: "2026-01-05" },
        { name: "School Opening (2nd Sem)", start: "2026-01-05" },
        {
          name: "Senior Government Day",
          start: "2026-01-20",
          end: "2026-01-21",
        },
        { name: "Faculty Family", start: "2026-01-30" },
        { name: "Junior Vespers", start: "2026-02-06" },
        { name: "NHS Applications Deadline", start: "2026-02-10" },
        {
          name: "Weekend of Spiritual Emphasis",
          start: "2026-02-13",
          end: "2026-02-14",
        },
        { name: "ACT", start: "2026-02-13" },
        { name: "NHS Induction", start: "2026-02-17" },
        { name: "Mt. Kenya Trip", start: "2026-02-20", end: "2026-02-24" },
        { name: "Senior Dedication", start: "2026-02-27" },
        { name: "Sophomore Vespers", start: "2026-03-06" },
        {
          name: "Student-Led Week of Prayer",
          start: "2026-03-09",
          end: "2026-03-14",
        },
        { name: "Track and Field", start: "2026-03-19", end: "2026-03-20" },
        { name: "Chorale Sacred Concert", start: "2026-03-21" },
        { name: "Senior Class Trip", start: "2026-03-23", end: "2026-03-26" },
        { name: "Midterm Break", start: "2026-03-26", end: "2026-04-06" },
        {
          name: "Ethiopia Mission Trip",
          start: "2026-03-26",
          end: "2026-04-05",
        },
        { name: "ACT", start: "2026-04-10" },
        { name: "Freshmen Vespers", start: "2026-04-17" },
        { name: "Faculty Family", start: "2026-04-19" },
        { name: "Week of Prayer", start: "2026-04-20", end: "2026-04-25" },
        { name: "Long Weekend", start: "2026-04-30", end: "2026-05-03" },
        { name: "ASB Spirit Week", start: "2026-05-04", end: "2026-05-09" },
        { name: "Class Surveys", start: "2026-05-11", end: "2026-05-13" },
        { name: "ASB Elections", start: "2026-05-12" },
        { name: "Spring Concert", start: "2026-05-16" },
        { name: "MAP Testing", start: "2026-05-18", end: "2026-05-21" },
        { name: "Dorm Parties", start: "2026-05-23" },
        { name: "Dorm Outings", start: "2026-05-24" },
        { name: "Finals Review Week", start: "2026-05-25", end: "2026-05-29" },
        { name: "Zamani Night", start: "2026-05-30" },
        { name: "Elementary Graduation", start: "2026-05-31" },
        { name: "Final Exams 2nd Sem", start: "2026-06-02", end: "2026-06-04" },
        { name: "GRADDDDD!!!!", start: "2026-06-05", end: "2026-06-07" },
      ];

      const MONTH_COLORS = {
        "01": "#e74c3c",
        "02": "#ff8a65",
        "03": "#f6c85f",
        "04": "#8dd3c7",
        "05": "#66a3ff",
        "06": "#9b59b6",
        "07": "#f06292",
        "08": "#ffb84d",
        "09": "#6ab04c",
        10: "#4a90e2",
        11: "#34495e",
        12: "#7bdbdb",
      };

      /* campus photos (first 4 replaced per your note, then additional images) */
      const CAMPUS_PHOTOS = [
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmV27Af6dGvJoR-LVUGmkCauwQepWKLwi7Zw&s",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTHDr-_KeMgIf8tN3PHxytKFN7lbUhaLuPpkQ&s",
        "https://static.wixstatic.com/media/b62f56_ce88667acf42430fbea4c12175730dd3.jpg/v1/fill/w_960,h_640,al_c,q_85,enc_avif,quality_auto/b62f56_ce88667acf42430fbea4c12175730dd3.jpg",
        "https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/03/EsoPheb.jpeg?fit=1400%2C1400&ssl=1",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwjR3VnDRD6LdSrblZYVliJaRRigcs-tRg1A&s",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_UAdf79fDLKoBvHdkMag3M7D2yQ_LqeaMfEHAc2SL3tjaM2YgYv7lnp03azSa0QtDdfs&usqp=CAU",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRSf7j4BoCP9Y4wsnOAPCmjaGtQ--w7biBxRWvnQXHA2_Jo0WCWdGmEeX5rB87zfhaWHQo&usqp=CAU",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQF4CttDiXRUIEdVk0US158Ob3-siokVF2RSppthCTBNSNtkbNshzNTVMTK0UxNVIqfpVc&usqp=CAU",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTLWlAao-P3ibqUPD9n0AmP5nHL0BzwrYsPMRD7yNfh0To0pjm4gfLZkDMCY2OoesrqEXo&usqp=CAU",
      ];

      /* additional monthly / nature images for gallery */
      const MUSEUM_PHOTOS = [
        {
          src: "https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/04/VideoCover-1.jpeg?resize=767%2C500&ssl=1",
          caption: "Campus â€” Banner",
          month: "08",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1600&q=80&auto=format&fit=crop",
          caption: "Forest Path",
          month: "09",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1600&q=80&auto=format&fit=crop",
          caption: "Lake at Dawn",
          month: "10",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1503264116251-35a269479413?w=1600&q=80&auto=format&fit=crop",
          caption: "Foggy Ridge",
          month: "12",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1600&q=80&auto=format&fit=crop",
          caption: "Mountain Trail",
          month: "03",
          year: 2026,
        },
        {
          src: "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=1600&q=80&auto=format&fit=crop",
          caption: "Sunset Camp",
          month: "05",
          year: 2026,
        },
      ];

      /* birthdays (Sept only data you gave) â€” Note: 'Arcella Ineza' (no comma), Daniela & Daniel separate */
      const BIRTHDAYS = [
        { day: 11, month: 9, name: "Tereza Poniatovska" },
        { day: 20, month: 9, name: "Tendai Castroe" },
        { day: 25, month: 9, name: "Arcella Ineza" }, // removed comma as requested
        { day: 25, month: 9, name: "Salome Lwanzo" },
        { day: 2, month: 9, name: "Adrian Ochieng" },
        { day: 25, month: 9, name: "Julian Tito Omonte" },
        { day: 25, month: 9, name: "Jael Tito Omonte" },
        { day: 4, month: 9, name: "Ethan Wenyika" },
        { day: 14, month: 9, name: "Michael Nyange" },
        { day: 17, month: 9, name: "Daniela" },
        { day: 17, month: 9, name: "Daniel" },
        { day: 6, month: 9, name: "Kris Koome" },
        { day: 24, month: 9, name: "Betty Kamawu" },
      ];

      /* -------------------------
   Helpers
   ------------------------- */
      const $ = (id) => document.getElementById(id);
      const pad = (n) => (n < 10 ? "0" + n : String(n));
      const parseDate = (s) =>
        s.includes("T") ? new Date(s) : new Date(s + "T00:00:00");
      const parseEnd = (e, start) => {
        if (!e) {
          const d = new Date(start);
          d.setHours(23, 59, 59, 999);
          return d;
        }
        return e.includes("T") ? new Date(e) : new Date(e + "T23:59:59.999");
      };
      const formatISO = (d) =>
        `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
      const shortMonth = (m) =>
        new Date(2000, m - 1, 1).toLocaleString("en", { month: "short" });
      function slug(s, i) {
        return (
          String(s)
            .toLowerCase()
            .replace(/[â€™'"]/g, "")
            .replace(/[:\/\\(),.!?#\u2013\u2014]/g, "")
            .replace(/\s+/g, "-")
            .replace(/[^a-z0-9\-]/g, "") +
          "-" +
          i
        );
      }
      function eventIcon(name) {
        const n = name.toLowerCase();
        if (/exam|final|test|act|map/.test(n)) return "ðŸ“";
        if (
          /break|holiday|christmas|spring|long weekend|summer|vacation/.test(n)
        )
          return "ðŸŽ‰";
        if (/trip|camp|mt|mountain|mission/.test(n)) return "ðŸ•ï¸";
        if (/concert|chorale|music/.test(n)) return "ðŸŽµ";
        if (/sports|track|field/.test(n)) return "ðŸ…";
        return "ðŸ“…";
      }

      /* -------------------------
   State & storage helpers
   ------------------------- */
      const PIN_KEY = "maxwell_pins_v3";
      function getPins() {
        try {
          return JSON.parse(localStorage.getItem(PIN_KEY) || "[]");
        } catch (e) {
          return [];
        }
      }
      function setPins(arr) {
        localStorage.setItem(PIN_KEY, JSON.stringify(arr));
        renderPinnedPanel();
      }
      function isPinned(idx) {
        return getPins().includes(idx);
      }
      function togglePin(idx) {
        const arr = getPins();
        const pos = arr.indexOf(idx);
        if (pos === -1) {
          arr.unshift(idx);
          while (arr.length > 50) arr.pop();
        } else arr.splice(pos, 1);
        setPins(arr);
      }

      /* -------------------------
   Rendering: EVENTS GRID
   ------------------------- */
      let renderedItems = []; // {idx, start,end,el,id}
      function renderEvents() {
        const container = $("eventsContainer");
        container.innerHTML = "";
        // sort by start
        EVENTS.sort((a, b) => parseDate(a.start) - parseDate(b.start));
        const q = $("search").value.trim().toLowerCase();
        const monthFilter = $("monthFilter").value;
        let currentGroup = "";
        EVENTS.forEach((ev, idx) => {
          if (q && !ev.name.toLowerCase().includes(q)) return;
          if (monthFilter && ev.start.slice(5, 7) !== monthFilter) return;
          const start = parseDate(ev.start);
          const mmKey = `${start.getFullYear()}-${pad(start.getMonth() + 1)}`;
          if (mmKey !== currentGroup) {
            currentGroup = mmKey;
            const head = document.createElement("div");
            head.className = "month-heading";
            head.textContent = `${start.toLocaleString("en", {
              month: "long",
            })} ${start.getFullYear()}`;
            head.dataset.month = pad(start.getMonth() + 1);
            head.addEventListener("click", () => {
              $("monthFilter").value = head.dataset.month;
              renderEvents();
            });
            container.appendChild(head);
          }
          const end = parseEnd(ev.end, start);
          const id = slug(ev.name, idx);
          const card = document.createElement("article");
          card.className = "card";
          card.dataset.idx = idx;
          card.dataset.id = id;
          const monthColor = MONTH_COLORS[pad(start.getMonth() + 1)] || "#999";
          card.innerHTML = `
      <div class="month-strip" style="background:${monthColor}"></div>
      <button class="pin" aria-label="Pin event" title="Pin event">ðŸ“Œ</button>
      <div class="big-badge">${eventIcon(ev.name)}</div>
      <div class="title"><span class="icon">${eventIcon(
        ev.name
      )}</span><div style="flex:1">${ev.name}</div></div>
      <div class="meta">${
        ev.end
          ? `${formatISO(start)} â†’ ${formatISO(parseDate(ev.end))}`
          : formatISO(start)
      }</div>
      <div class="count" id="cd-${id}">â€”</div>
      <div class="status" id="st-${id}">â€”</div>
      <div class="date-badge">${formatDateBadge(ev.start, ev.end)}</div>
    `;
          container.appendChild(card);

          // pin wiring
          const pb = card.querySelector(".pin");
          const refreshPinVisual = () =>
            pb.classList.toggle("active", isPinned(idx));
          pb.addEventListener("click", (e) => {
            e.stopPropagation();
            togglePin(idx);
            refreshPinVisual();
          });
          refreshPinVisual();

          // store item
          renderedItems.push({ idx, start, end, el: card, id });
        });

        // update loop
        startTicking();
        renderPinnedPanel();
      }

      /* countdown helpers */
      function formatDateBadge(start, end) {
        const s = parseDate(start);
        const e = end ? parseDate(end) : null;
        if (!e) return `${shortMonth(s.getMonth() + 1)} ${s.getDate()}`;
        if (
          s.getFullYear() === e.getFullYear() &&
          s.getMonth() === e.getMonth()
        )
          return `${shortMonth(
            s.getMonth() + 1
          )} ${s.getDate()}â€“${e.getDate()}`;
        return `${shortMonth(s.getMonth() + 1)} ${s.getDate()} â€“ ${shortMonth(
          e.getMonth() + 1
        )} ${e.getDate()}`;
      }

      let tickHandle = null;
      function startTicking() {
        if (tickHandle) clearInterval(tickHandle);
        function tick() {
          const now = new Date();
          renderedItems.forEach((item) => {
            const { id, start, end, el } = item;
            const cd = $("cd-" + id),
              st = $("st-" + id);
            if (!cd || !st) return;
            if (now.getTime() < start.getTime()) {
              el.classList.remove("happening", "finished");
              el.classList.add("upcoming");
              const diff = start.getTime() - now.getTime();
              const d = Math.floor(diff / 86400000),
                h = Math.floor((diff % 86400000) / 3600000),
                m = Math.floor((diff % 3600000) / 60000),
                s = Math.floor((diff % 60000) / 1000);
              cd.textContent = `${d}d ${h}h ${m}m ${s}s left`;
              st.textContent = "â³ Coming soon";
            } else if (now.getTime() > end.getTime()) {
              el.classList.remove("upcoming", "happening");
              el.classList.add("finished");
              cd.textContent = `Ended ${formatISO(end)}`;
              st.textContent = "âœ… Finished";
            } else {
              el.classList.remove("upcoming", "finished");
              el.classList.add("happening");
              const diff = end.getTime() - now.getTime();
              const d = Math.floor(diff / 86400000),
                h = Math.floor((diff % 86400000) / 3600000),
                m = Math.floor((diff % 3600000) / 60000),
                s = Math.floor((diff % 60000) / 1000);
              cd.textContent = `${d}d ${h}h ${m}m ${s}s remaining`;
              st.textContent = "ðŸ”´ Happening now";
            }
          });
          updatePinnedCounts();
        }
        tick();
        tickHandle = setInterval(tick, 1000);
      }

      /* -------------------------
   PINNED PANEL RENDERING
   - only shows pinned items (nothing else)
   - hidden entirely when no pins
   ------------------------- */
      function renderPinnedPanel() {
        const panel = $("pinnedPanel"),
          list = $("pinnedList"),
          toggle = $("pinnedToggle");
        const pins = getPins();
        list.innerHTML = "";
        if (!pins || pins.length === 0) {
          panel.classList.add("hidden");
          panel.setAttribute("aria-hidden", "true");
          toggle.classList.add("hidden");
          return;
        }
        panel.classList.remove("hidden");
        panel.setAttribute("aria-hidden", "false");
        toggle.classList.remove("hidden");

        // build list (only pinned)
        pins.forEach((i) => {
          const ev = EVENTS[i];
          if (!ev) return;
          const start = parseDate(ev.start),
            end = parseEnd(ev.end, start);
          const chip = document.createElement("div");
          chip.className = "pinned-item";
          chip.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">${ev.name}</div>
      <div style="font-weight:800;color:var(--accent)">${formatDateBadge(
        ev.start,
        ev.end
      )}</div>
    </div>
    <div style="font-size:13px;color:#27506b" id="pinnedStatus-${i}">â€”</div>`;
          chip.addEventListener("click", () => {
            // scroll to event in grid
            const target = Array.from(document.querySelectorAll(".card")).find(
              (c) => Number(c.dataset.idx) === i
            );
            if (target) {
              target.scrollIntoView({ behavior: "smooth", block: "center" });
              target.style.transform = "translateY(-8px)";
              target.style.boxShadow = "0 20px 60px rgba(255,180,60,0.28)";
              setTimeout(() => {
                target.style.transform = "";
                target.style.boxShadow = "";
              }, 1200);
            }
          });
          list.appendChild(chip);
        });
        updatePinnedCounts();
      }

      function updatePinnedCounts() {
        const pins = getPins();
        pins.forEach((i) => {
          const el = $("pinnedStatus-" + i);
          if (!el) return;
          const ev = EVENTS[i];
          const now = new Date();
          const start = parseDate(ev.start),
            end = parseEnd(ev.end, start);
          if (now.getTime() < start.getTime()) {
            const diff = start.getTime() - now.getTime();
            const d = Math.floor(diff / 86400000),
              h = Math.floor((diff % 86400000) / 3600000),
              m = Math.floor((diff % 3600000) / 60000);
            el.textContent = `${d}d ${h}h ${m}m until start`;
          } else if (now.getTime() > end.getTime()) {
            const diff = now.getTime() - end.getTime();
            const d = Math.floor(diff / 86400000);
            el.textContent = `Ended ${d}d ago`;
          } else {
            const diff = end.getTime() - now.getTime();
            const d = Math.floor(diff / 86400000),
              h = Math.floor((diff % 86400000) / 3600000),
              m = Math.floor((diff % 3600000) / 60000);
            el.textContent = `${d}d ${h}h ${m}m remaining`;
          }
        });
      }

      /* -------------------------
   GALLERY rendering (square tiles)
   ------------------------- */
      function renderGallery() {
        const campus = $("campusTiles"),
          monthly = $("monthlyTiles");
        campus.innerHTML = "";
        monthly.innerHTML = "";
        CAMPUS_PHOTOS.forEach((src, i) => {
          const t = document.createElement("div");
          t.className = "tile";
          t.tabIndex = 0;
          t.innerHTML = `<img src="${src}" alt="Campus image ${
            i + 1
          }"><div class="cap">Campus</div>`;
          t.addEventListener("click", () => openLightbox(CAMPUS_PHOTOS, i));
          campus.appendChild(t);
        });
        MUSEUM_PHOTOS.forEach((p, i) => {
          const t = document.createElement("div");
          t.className = "tile";
          t.tabIndex = 0;
          t.innerHTML = `<img src="${p.src}" alt="${p.caption}"><div class="cap">${p.caption}</div>`;
          t.addEventListener("click", () =>
            openLightbox(
              MUSEUM_PHOTOS.map((x) => x.src),
              i,
              MUSEUM_PHOTOS
            )
          );
          monthly.appendChild(t);
        });
      }

      /* -------------------------
   Lightbox (gallery)
   ------------------------- */
      let lbItems = [],
        lbIndex = 0;
      function openLightbox(items, idx, meta) {
        // items can be array of strings or array of objects
        if (Array.isArray(items) && typeof items[0] === "string") {
          lbItems = items;
        } else if (Array.isArray(items) && items[0] && items[0].src) {
          lbItems = items.map((x) => x.src);
        }
        lbIndex = idx || 0;
        const light = $("lightbox");
        $("lbImg").src = lbItems[lbIndex];
        $("lbCap").textContent =
          meta && meta[lbIndex] && meta[lbIndex].caption
            ? meta[lbIndex].caption
            : "";
        light.classList.add("open");
        light.setAttribute("aria-hidden", "false");
      }
      function closeLightbox() {
        const light = $("lightbox");
        light.classList.remove("open");
        light.setAttribute("aria-hidden", "true");
      }
      $("lbClose").addEventListener("click", closeLightbox);
      $("lbNext").addEventListener("click", () => {
        lbIndex = (lbIndex + 1) % lbItems.length;
        $("lbImg").src = lbItems[lbIndex];
      });
      $("lbPrev").addEventListener("click", () => {
        lbIndex = (lbIndex - 1 + lbItems.length) % lbItems.length;
        $("lbImg").src = lbItems[lbIndex];
      });
      document.addEventListener("keydown", (e) => {
        const light = $("lightbox");
        if (light.classList.contains("open")) {
          if (e.key === "Escape") closeLightbox();
          if (e.key === "ArrowRight") $("lbNext").click();
          if (e.key === "ArrowLeft") $("lbPrev").click();
        }
      });

      /* -------------------------
   BIRTHDAYS rendering and popups
   - special: on load sequential popups for today's birthdays (2s each)
   ------------------------- */
      function renderBirthdays() {
        const grid = $("birthdaysGrid");
        grid.innerHTML = "";
        // sort by day
        const sorted = BIRTHDAYS.slice().sort(
          (a, b) =>
            a.month - b.month || a.day - b.day || a.name.localeCompare(b.name)
        );
        const now = new Date();
        sorted.forEach((b) => {
          const next = nextBirthdayDate(b.day, b.month);
          const sinceOrUntil = timeDeltaText(next, now);
          const card = document.createElement("div");
          card.className = "birth-card";
          card.innerHTML = `<div class="name">${
            b.name
          }</div><div class="when">${shortMonth(b.month)} ${
            b.day
          }</div><div class="countdown" id="bd-${b.name.replace(
            /\s+/g,
            "_"
          )}">${sinceOrUntil}</div>`;
          // make non-interactive (read-only)
          card.style.pointerEvents = "none";
          grid.appendChild(card);
        });
        // update countdown every 30s
        setInterval(() => {
          document.querySelectorAll(".birth-card").forEach((c, idx) => {
            const data = BIRTHDAYS[idx];
            const el = c.querySelector(".countdown");
            if (el) {
              el.textContent = timeDeltaText(
                nextBirthdayDate(data.day, data.month),
                new Date()
              );
            }
          });
        }, 30000);
      }

      /* compute next birthday date for given day/month relative to today */
      function nextBirthdayDate(day, month) {
        const now = new Date();
        const year = now.getFullYear();
        const candidate = new Date(year, month - 1, day, 0, 0, 0, 0);
        if (candidate.getTime() < now.getTime()) {
          candidate.setFullYear(year + 1);
        }
        return candidate;
      }
      function timeDeltaText(target, now) {
        const diff = target.getTime() - now.getTime();
        if (diff >= 0) {
          const d = Math.floor(diff / 86400000),
            h = Math.floor((diff % 86400000) / 3600000),
            m = Math.floor((diff % 3600000) / 60000);
          return `${d}d ${h}h ${m}m to next`;
        } else {
          const diff2 = -diff;
          const d = Math.floor(diff2 / 86400000);
          const h = Math.floor((diff2 % 86400000) / 3600000);
          return `${d}d ${h}h since`;
        }
      }

      /* On-load birthday popup sequence for birthdays that match today's month/day */
      async function runBirthdayPopups() {
        // find birthdays matching today's month/day (server time uses user's clock)
        const now = new Date();
        const todays = BIRTHDAYS.filter(
          (b) => b.month === now.getMonth() + 1 && b.day === now.getDate()
        );
        if (!todays || todays.length === 0) return;
        // sequential popups (2s each)
        for (const b of todays) {
          await showBirthdayPopup(b.name, 2000);
        }
      }

      /* show centered white popup with confetti/fireworks for duration (ms) */
      function showBirthdayPopup(name, duration = 2000) {
        return new Promise((resolve) => {
          const pop = $("bdPopup");
          const title = $("bdName");
          const line = $("bdLine");
          title.textContent = name;
          line.textContent = "ðŸŽ‰ Happy Birthday!";
          pop.classList.add("show", "shake");
          pop.setAttribute("aria-hidden", "false");
          startConfetti(duration);
          setTimeout(() => {
            pop.classList.remove("shake");
          }, 700);
          const hide = () => {
            pop.classList.remove("show");
            pop.setAttribute("aria-hidden", "true");
            stopConfetti();
            resolve();
          };
          setTimeout(hide, duration);
        });
      }

      /* -------------------------
   Confetti / Fireworks animation (smooth & subtle)
   - lightweight canvas particle system that runs for given ms
   ------------------------- */
      const confettiCanvas = $("confetti");
      let confCtx,
        confW = 0,
        confH = 0,
        confettiParticles = [],
        confettiRAF = null,
        confettiEndTimeout = null;
      function resizeConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
        confW = confettiCanvas.width;
        confH = confettiCanvas.height;
        confCtx = confettiCanvas.getContext("2d");
      }
      window.addEventListener("resize", resizeConfetti);
      resizeConfetti();

      function spawnFirework(x, y) {
        const count = 26 + Math.floor(Math.random() * 18);
        for (let i = 0; i < count; i++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = 2 + Math.random() * 4;
          const vx = Math.cos(angle) * speed;
          const vy = Math.sin(angle) * speed;
          confettiParticles.push({
            x,
            y,
            vx,
            vy,
            life: 0,
            ttl: 60 + Math.floor(Math.random() * 40),
            color: `hsl(${Math.floor(
              Math.random() * 50 + 20
            )}, 90%, ${Math.floor(Math.random() * 20 + 40)}%)`,
            size: 2 + Math.random() * 3,
            gravity: 0.03 + Math.random() * 0.06,
          });
        }
      }
      function spawnConfettiBurst() {
        for (let i = 0; i < 18; i++) {
          const x = Math.random() * confW;
          const y = confH * (0.15 + Math.random() * 0.65);
          spawnFirework(x, y);
        }
      }

      function confettiTick() {
        confCtx.clearRect(0, 0, confW, confH);
        for (let i = confettiParticles.length - 1; i >= 0; i--) {
          const p = confettiParticles[i];
          p.x += p.vx;
          p.y += p.vy;
          p.vy += p.gravity;
          p.vx *= 0.995;
          p.vy *= 0.995;
          p.life++;
          const alpha = 1 - p.life / p.ttl;
          confCtx.globalAlpha = Math.max(0, alpha);
          confCtx.fillStyle = p.color;
          confCtx.beginPath();
          confCtx.ellipse(p.x, p.y, p.size, p.size * 1.6, 0, 0, Math.PI * 2);
          confCtx.fill();
          if (p.life > p.ttl || p.y > confH + 30)
            confettiParticles.splice(i, 1);
        }
        confCtx.globalAlpha = 1;
        if (confettiParticles.length > 0) {
          confettiRAF = requestAnimationFrame(confettiTick);
        } else {
          // stop when empty
          confettiRAF = null;
        }
      }

      function startConfetti(ms = 2000) {
        // spawn repeated bursts for the duration
        spawnConfettiBurst();
        if (!confettiRAF) confettiTick();
        const interval = setInterval(spawnConfettiBurst, 350);
        confettiEndTimeout = setTimeout(() => {
          clearInterval(interval);
        }, ms);
      }

      function stopConfetti() {
        if (confettiEndTimeout) {
          clearTimeout(confettiEndTimeout);
          confettiEndTimeout = null;
        }
        // will naturally stop when particles die; but we can accelerate removal
        // leave to natural fade for nicer look
      }

      /* -------------------------
   PRESENT Mode (slideshow)
   ------------------------- */
      let presentIndex = 0,
        presentTimer = null,
        presentPlaying = true;
      function renderPresent() {
        const stage = $("presentStage");
        stage.innerHTML = "";
        // create cards array from EVENTS (filtered by search/month if any)
        const q = $("search").value.trim().toLowerCase();
        const monthFilter = $("monthFilter").value;
        const pool = EVENTS.filter((ev, i) => {
          if (q && !ev.name.toLowerCase().includes(q)) return false;
          if (monthFilter && ev.start.slice(5, 7) !== monthFilter) return false;
          return true;
        });
        if (pool.length === 0) {
          stage.innerHTML =
            '<div style="color:#fff">No events to present</div>';
          return;
        }
        // show the current index as a large card
        const ev = pool[presentIndex % pool.length];
        const start = parseDate(ev.start),
          end = parseEnd(ev.end, start);
        const card = document.createElement("div");
        card.className = "present-card";
        card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;width:100%"><div style="font-weight:900;font-size:20px">${
          ev.name
        }</div><div style="color:var(--accent);font-weight:900">${formatDateBadge(
          ev.start,
          ev.end
        )}</div></div>
    <div style="font-size:14px;color:#27506b">${
      ev.end
        ? `${formatISO(start)} â†’ ${formatISO(parseDate(ev.end))}`
        : formatISO(start)
    }</div>
    <div id="presentCountdown" style="font-weight:900;color:var(--accent);font-size:18px">â€”</div>
    <div style="margin-top:10px;color:#16344f;font-weight:700" id="presentStatus">â€”</div>`;
        stage.appendChild(card);
        updatePresentCountdown(ev, card);
        // auto-advance
        if (presentTimer) clearInterval(presentTimer);
        if (presentPlaying)
          presentTimer = setInterval(() => {
            presentIndex = (presentIndex + 1) % pool.length;
            renderPresent();
          }, 6000);
      }
      function updatePresentCountdown(ev, card) {
        const cd = card.querySelector("#presentCountdown"),
          st = card.querySelector("#presentStatus");
        const now = new Date();
        const start = parseDate(ev.start),
          end = parseEnd(ev.end, start);
        if (now.getTime() < start.getTime()) {
          const diff = start.getTime() - now.getTime();
          const d = Math.floor(diff / 86400000),
            h = Math.floor((diff % 86400000) / 3600000),
            m = Math.floor((diff % 3600000) / 60000);
          cd.textContent = `${d}d ${h}h ${m}m to start`;
          st.textContent = "â³ Coming soon";
        } else if (now.getTime() > end.getTime()) {
          cd.textContent = `Finished on ${formatISO(end)}`;
          st.textContent = "âœ… Finished";
        } else {
          const diff = end.getTime() - now.getTime();
          const d = Math.floor(diff / 86400000),
            h = Math.floor((diff % 86400000) / 3600000),
            m = Math.floor((diff % 3600000) / 60000);
          cd.textContent = `${d}d ${h}h ${m}m remaining`;
          st.textContent = "ðŸ”´ Happening now";
        }
      }

      /* -------------------------
   UI wiring / tab switching / boot
   ------------------------- */
      function setActiveTab(tab) {
        // hide all sections
        [
          "sectionGrid",
          "sectionGallery",
          "sectionBirthdays",
          "sectionPresent",
        ].forEach((id) => ($(id).style.display = "none"));
        ["tabGrid", "tabGallery", "tabBirthdays", "tabPresent"].forEach((b) =>
          $(b).classList.remove("active")
        );
        // show selected
        if (tab === "grid") {
          $("sectionGrid").style.display = "block";
          $("tabGrid").classList.add("active");
        }
        if (tab === "gallery") {
          $("sectionGallery").style.display = "block";
          $("tabGallery").classList.add("active");
        }
        if (tab === "birthdays") {
          $("sectionBirthdays").style.display = "block";
          $("tabBirthdays").classList.add("active");
        }
        if (tab === "present") {
          $("sectionPresent").style.display = "block";
          $("tabPresent").classList.add("active");
        }
      }

      $("tabGrid").addEventListener("click", () => {
        setActiveTab("grid");
        $("btnGrid").classList.add("primary");
        $("btnGallery").classList.remove("primary");
      });
      $("tabGallery").addEventListener("click", () => {
        setActiveTab("gallery");
        $("btnGallery").classList.add("primary");
        $("btnGrid").classList.remove("primary");
      });
      $("tabBirthdays").addEventListener("click", () => {
        setActiveTab("birthdays");
        $("btnBirths").classList.add("primary");
      });
      $("tabPresent").addEventListener("click", () => {
        setActiveTab("present");
        $("btnPresent").classList.add("primary");
        renderPresent();
      });

      $("btnGrid").addEventListener("click", () => {
        setActiveTab("grid");
      });
      $("btnGallery").addEventListener("click", () => {
        setActiveTab("gallery");
        renderGallery();
      });
      $("btnBirths").addEventListener("click", () => {
        setActiveTab("birthdays");
      });
      $("btnPresent").addEventListener("click", () => {
        setActiveTab("present");
        renderPresent();
      });

      // search / month filter wiring
      $("search").addEventListener("input", () => {
        // rerender grid & present
        renderedItems = [];
        renderEvents();
        renderPresent();
      });
      $("monthFilter").addEventListener("change", () => {
        renderedItems = [];
        renderEvents();
        renderGallery();
        renderPresent();
      });

      // pinned panel toggle & clear
      $("pinnedToggle").addEventListener("click", () => {
        $("pinnedPanel").classList.toggle("hidden");
      });
      $("hidePins").addEventListener("click", () => {
        $("pinnedPanel").classList.add("hidden");
      });
      $("clearPins").addEventListener("click", () => {
        setPins([]);
      });
      $("exportPins").addEventListener("click", () => {
        const pins = getPins();
        const rows = [["name", "start", "end"]];
        pins.forEach((i) => {
          const ev = EVENTS[i];
          if (ev) rows.push([ev.name, ev.start || "", ev.end || ""]);
        });
        const csv = rows
          .map((r) =>
            r.map((c) => `"${String(c).replace(/"/g, '""')}"`).join(",")
          )
          .join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "pinned.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      // keyboard quick toggle P to show/hide pinned
      document.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() === "p" && !e.ctrlKey && !e.metaKey) {
          const p = $("pinnedPanel");
          if (p) p.classList.toggle("hidden");
        }
      });

      // present controls
      $("enterFs").addEventListener("click", () => {
        document.documentElement.requestFullscreen?.();
      });
      $("pauseSlideshow").addEventListener("click", () => {
        presentPlaying = !presentPlaying;
        if (presentPlaying) {
          renderPresent();
          $("pauseSlideshow").textContent = "Pause";
        } else {
          if (presentTimer) clearInterval(presentTimer);
          $("pauseSlideshow").textContent = "Play";
        }
      });

      /* -------------------------
   Year progress (from first event start to last event end)
   ------------------------- */
      function updateYearProgress() {
        if (EVENTS.length === 0) return;
        const start = parseDate(EVENTS[0].start);
        const last = EVENTS[EVENTS.length - 1];
        const end = parseEnd(last.end, parseDate(last.start));
        const now = new Date();
        const total = end.getTime() - start.getTime();
        const passed = Math.max(
          0,
          Math.min(total, now.getTime() - start.getTime())
        );
        const pct = Math.round((passed / total) * 100);
        $("yearProgress").style.width = pct + "%";
      }

      /* -------------------------
   Accent sample from hero or fallback
   ------------------------- */
      async function sampleAccent() {
        const img = $("heroImg");
        if (!img) return;
        await new Promise((r) => {
          if (img.complete) return r();
          img.addEventListener("load", r);
          img.addEventListener("error", r);
        });
        try {
          const w = Math.min(img.naturalWidth || 200, 160),
            h = Math.min(img.naturalHeight || 120, 120);
          const c = document.createElement("canvas");
          c.width = w;
          c.height = h;
          const ctx = c.getContext("2d");
          ctx.drawImage(img, 0, 0, w, h);
          const data = ctx.getImageData(0, 0, w, h).data;
          let r = 0,
            g = 0,
            b = 0,
            count = 0;
          for (let i = 0; i < data.length; i += 4) {
            const a = data[i + 3];
            if (a < 80) continue;
            r += data[i];
            g += data[i + 1];
            b += data[i + 2];
            count++;
          }
          if (count === 0) throw new Error("no pixels");
          r = Math.round(r / count);
          g = Math.round(g / count);
          b = Math.round(b / count);
          const rgb = `rgb(${r},${g},${b})`;
          document.documentElement.style.setProperty("--accent", rgb);
          const lum = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
          document.documentElement.style.setProperty(
            "--accent-text",
            lum > 0.6 ? "#072238" : "#fff"
          );
        } catch (e) {
          // fallback using next upcoming event month color
          const next = EVENTS.find(
            (ev) =>
              parseEnd(ev.end, parseDate(ev.start)).getTime() >= Date.now()
          );
          if (next) {
            const m = pad(parseDate(next.start).getMonth() + 1);
            const col = MONTH_COLORS[m] || "#ffd24a";
            document.documentElement.style.setProperty("--accent", col);
            document.documentElement.style.setProperty(
              "--accent-text",
              "#072238"
            );
          }
        }
      }

      /* -------------------------
   On startup: render everything and run birthday popups if needed
   ------------------------- */
      document.addEventListener("DOMContentLoaded", async () => {
        renderEvents();
        renderGallery();
        renderBirthdays();
        updateYearProgress();
        await sampleAccent(); // sets --accent
        // show birthday popups (sequential) if today matches
        await runBirthdayPopups();
      });

      /* ensure confetti canvas sized properly */
      window.addEventListener("resize", () => {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      });
    </script>
  </body>
</html>
