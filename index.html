<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Maxwell Events — 2025–2026</title>
    <style>
      :root {
        --accent: #ffd24a;
        --accent-2: #ffb84d;
        --bg: #07131a;
        --card-radius: 14px;
        --panel-width: 340px;
        --text-dark: #072238;
        --muted: #9fbfd4;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        background: linear-gradient(180deg, #07131a, #041018);
        color: #eaf6ff;
        padding: 20px;
        -webkit-font-smoothing: antialiased;
      }

      /* Page grid (main + optional right pinned panel) */
      .page {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr var(--panel-width);
        gap: 20px;
        align-items: start;
        transition: all 0.2s ease;
      }
      .page.pinned-hidden {
        grid-template-columns: 1fr;
      }

      header {
        grid-column: 1/-1;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 12px;
      }
      .left {
        max-width: 820px;
      }
      h1 {
        font-size: 1.5rem;
        color: #fff;
        font-weight: 900;
      }
      .subtitle {
        color: var(--muted);
        margin-top: 6px;
        font-weight: 600;
      }

      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 12px;
        flex-wrap: wrap;
      }
      input[type="search"],
      select {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: #fff;
        color: var(--text-dark);
      }
      .btn {
        padding: 8px 12px;
        border-radius: 10px;
        border: none;
        background: rgba(255, 255, 255, 0.06);
        color: inherit;
        cursor: pointer;
        font-weight: 800;
      }
      .btn.primary {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: var(--text-dark);
      }

      /* Hero */
      .hero {
        grid-column: 1/-1;
        position: relative;
        border-radius: var(--card-radius);
        overflow: hidden;
        height: 300px;
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.5);
      }
      .hero img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center top;
        transition: transform 0.6s ease;
        display: block;
      }
      @media (max-width: 999px) {
        .hero img {
          object-position: center center;
        }
      }
      .hero::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0) 36%,
          rgba(0, 0, 0, 0.86) 100%
        );
        pointer-events: none;
      }
      .hero .overlay {
        position: absolute;
        left: 20px;
        bottom: 20px;
        z-index: 2;
        color: #fff;
      }

      /* Main */
      .wrap {
        padding: 0 12px;
      }
      .top-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 8px;
      }
      .year-progress {
        height: 8px;
        background: rgba(255, 255, 255, 0.06);
        border-radius: 999px;
        overflow: hidden;
        margin: 12px 0;
      }
      .year-progress > i {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
      }

      /* Grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
      }
      .month-heading {
        grid-column: 1/-1;
        padding: 8px 0;
        font-weight: 900;
        color: #fff;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        cursor: pointer;
      }

      /* Card */
      .card {
        position: relative;
        border-radius: 12px;
        background: linear-gradient(180deg, #ffffff, #fafcff);
        color: var(--text-dark);
        padding: 16px;
        box-shadow: 0 10px 30px rgba(2, 8, 23, 0.08);
        display: flex;
        flex-direction: column;
        min-height: 170px;
        transition: transform 0.22s, box-shadow 0.22s, filter 0.22s,
          opacity 0.22s;
        overflow: hidden;
      }
      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 26px 60px rgba(2, 8, 23, 0.12);
      }
      .month-strip {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 6px;
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
      }
      .pin-btn {
        position: absolute;
        right: 12px;
        top: 12px;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        border: none;
        background: rgba(7, 18, 43, 0.04);
        cursor: pointer;
        font-weight: 900;
      }
      .pin-btn.active {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: var(--text-dark);
        box-shadow: 0 12px 36px rgba(255, 180, 60, 0.12);
      }

      .title {
        min-height: 48px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .title .text {
        font-weight: 900;
        font-size: 18px;
        color: var(--text-dark);
        letter-spacing: -0.2px;
      }
      .meta {
        font-size: 13px;
        color: #27506b;
        min-height: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .countdown {
        font-weight: 800;
        font-size: 14px;
        color: var(--accent);
        min-height: 22px;
      }
      .status {
        font-size: 13px;
        color: #16344f;
        font-weight: 700;
        min-height: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .date-badge {
        align-self: flex-start;
        padding: 6px 8px;
        border-radius: 8px;
        background: rgba(7, 18, 43, 0.04);
        font-weight: 800;
      }
      .big-letter {
        position: absolute;
        right: -6px;
        top: -14px;
        font-size: 84px;
        font-weight: 900;
        color: rgba(7, 18, 43, 0.05);
        pointer-events: none;
      }

      .card.finished {
        opacity: 0.72;
        filter: grayscale(0.45);
      }
      .card.happening {
        box-shadow: 0 26px 80px rgba(255, 75, 75, 0.08);
        border: 1px solid rgba(255, 120, 80, 0.03);
      }

      /* Present mode (fullscreen, big centered card view) */
      body.present-mode {
        background: #000;
        overflow: hidden;
      }
      body.present-mode header,
      body.present-mode .controls,
      body.present-mode .wrap > .top-row,
      body.present-mode .hero {
        display: none !important;
      }
      body.present-mode .grid {
        display: flex;
        gap: 24px;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding: 40px;
      }
      body.present-mode .card {
        width: 820px;
        height: 520px;
        min-height: 0;
        border-radius: 18px;
        font-size: 20px;
        display: flex;
        align-items: flex-start;
        padding: 28px;
        box-shadow: 0 40px 120px rgba(2, 8, 23, 0.6);
      }
      #presentExit {
        position: fixed;
        right: 18px;
        top: 18px;
        z-index: 2000;
        display: none;
      }

      /* Present slide overlay (images/captions) */
      .present-slide {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.85),
          rgba(0, 0, 0, 0.95)
        );
      }
      .present-slide.open {
        display: flex;
      }
      .present-slide .slide-inner {
        max-width: 1400px;
        width: 100%;
        max-height: 90vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        gap: 12px;
      }
      .present-slide img {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
        border-radius: 12px;
        box-shadow: 0 40px 150px rgba(0, 0, 0, 0.6);
      }
      .present-slide .slide-caption {
        position: absolute;
        left: 40px;
        bottom: 40px;
        color: #fff;
        background: rgba(0, 0, 0, 0.35);
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 800;
      }
      .present-slide .controls {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px;
        pointer-events: none;
      }
      .present-slide button {
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.06);
        border: none;
        color: #fff;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 800;
      }

      /* Gallery - square cubicles */
      .gallery-wrap {
        margin-top: 18px;
      }
      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
      }
      .cubicle {
        position: relative;
        padding-top: 100%;
        border-radius: 12px;
        overflow: hidden;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        box-shadow: 0 10px 36px rgba(2, 8, 23, 0.12);
        cursor: pointer;
        transition: transform 0.28s, box-shadow 0.28s;
        display: block;
        border: none;
        text-align: left;
        color: inherit;
      }
      .cubicle:hover {
        transform: translateY(-6px) scale(1.01);
        box-shadow: 0 28px 80px rgba(2, 8, 23, 0.18);
      }
      .cubicle img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .cubicle .caption {
        position: absolute;
        left: 8px;
        bottom: 8px;
        background: rgba(0, 0, 0, 0.45);
        color: #fff;
        padding: 6px 8px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 12px;
      }

      /* Pinned panel */
      .pinned-column {
        position: sticky;
        top: 22px;
        height: calc(100vh - 44px);
        padding: 12px;
        background: #fff;
        color: var(--text-dark);
        border-radius: 12px;
        box-shadow: 0 26px 80px rgba(2, 8, 23, 0.12);
        overflow: auto;
      }
      .pinned-column.hidden {
        display: none;
      }
      .pinned-chip {
        background: #fff;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 12px 36px rgba(2, 8, 23, 0.06);
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .pin-empty {
        color: #6b7b8d;
        text-align: center;
        padding: 26px 12px;
        font-size: 14px;
      }

      /* pinned toggle floating button (when panel hidden but pins exist) */
      #pinnedToggleBtn {
        position: fixed;
        right: 18px;
        bottom: 18px;
        z-index: 1500;
        width: 56px;
        height: 56px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(180deg, var(--accent), var(--accent-2));
        box-shadow: 0 10px 36px rgba(2, 8, 23, 0.16);
        cursor: pointer;
        font-size: 20px;
        display: none;
      }

      /* Lightbox */
      .lightbox {
        position: fixed;
        inset: 0;
        background: rgba(1, 4, 8, 0.88);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1200;
        padding: 20px;
      }
      .lightbox.open {
        display: flex;
      }
      .lb-inner {
        max-width: 1100px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }
      .lb-inner img {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        border-radius: 10px;
      }
      .lb-caption {
        color: #fff;
        font-weight: 700;
      }
      .lb-controls {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        pointer-events: none;
      }
      .lb-controls button {
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.06);
        border: none;
        color: #fff;
        padding: 10px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 800;
      }

      /* Responsive tweaks */
      @media (max-width: 900px) {
        .page {
          grid-template-columns: 1fr;
        }
        .pinned-column {
          position: fixed;
          right: 12px;
          bottom: 12px;
          width: 320px;
          height: auto;
          z-index: 1100;
          transform: translateY(12px);
        }
        .hero {
          height: 220px;
        }
        .big-letter {
          font-size: 48px;
        }
        #pinnedToggleBtn {
          right: 12px;
          bottom: 12px;
        }
      }

      /* small animations */
      .fade-in {
        animation: fadeIn 0.36s ease both;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      :focus {
        outline: 3px solid rgba(255, 255, 255, 0.06);
        outline-offset: 4px;
      }
    </style>
  </head>
  <body>
    <div class="page pinned-hidden" id="root">
      <header>
        <div class="left">
          <h1>
            Maxwell Events Countdown —
            <span style="font-weight: 900">2025–2026</span>
          </h1>
          <div class="subtitle">2025–2026 schedule</div>

          <div class="controls" role="region" aria-label="Search and controls">
            <input
              id="searchBox"
              type="search"
              placeholder="Search events..."
              aria-label="Search events"
            />
            <select id="monthFilter" aria-label="Filter by month">
              <option value="">All months</option>
              <option value="01">January</option>
              <option value="02">February</option>
              <option value="03">March</option>
              <option value="04">April</option>
              <option value="05">May</option>
              <option value="06">June</option>
              <option value="07">July</option>
              <option value="08">August</option>
              <option value="09">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>

            <button id="gridBtn" class="btn primary" title="Grid view">
              Grid
            </button>
            <button id="museumBtn" class="btn" title="Museum gallery view">
              Museum
            </button>
            <button
              id="presentBtn"
              class="btn"
              title="Present (fullscreen) view"
            >
              Present
            </button>
          </div>
        </div>

        <div style="text-align: right; color: var(--muted); font-weight: 700">
          Maxwell • 2025–26
        </div>
      </header>

      <div class="hero fade-in" id="hero">
        <img
          id="heroImg"
          alt="Maxwell banner"
          src="https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/04/VideoCover-1.jpeg?resize=767%2C500&ssl=1"
          crossorigin="anonymous"
        />
        <div class="overlay">
          <div style="font-weight: 900; font-size: 18px">
            School Events Countdown
          </div>
          <div style="color: var(--muted); margin-top: 4px">
            Interactive schedule • gallery • pinned events
          </div>
        </div>
      </div>

      <main class="wrap">
        <div class="top-row">
          <div>
            <h1 id="pageTitle" style="color: #fff">School Events Countdown</h1>
            <div id="subtitle">2025-2026 schedule</div>

            <div class="year-progress" aria-hidden="true">
              <i id="yearProgressBar" style="width: 0%"></i>
            </div>
          </div>

          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 8px;
              align-items: flex-end;
              color: #fff;
              font-weight: 700;
            "
          >
            Maxwell • 2025–26
          </div>
        </div>

        <section
          id="nextUp"
          style="
            display: none;
            margin-bottom: 12px;
            padding: 12px;
            border-left: 6px solid var(--accent);
            background: #fff;
            color: var(--text-dark);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(2, 8, 23, 0.08);
          "
        >
          <div style="font-weight: 800; color: #0b4b6f">Next Up</div>
          <div style="margin-top: 6px">
            <strong id="nextUpName">—</strong> <span id="nextUpDetail"></span>
          </div>
        </section>

        <section id="stage">
          <div id="eventsGrid" class="grid" aria-live="polite"></div>
        </section>

        <section
          id="galleryControls"
          style="margin-top: 18px; display: flex; gap: 8px; align-items: center"
        >
          <div style="font-weight: 900; color: #fff">Gallery:</div>
          <button class="btn" id="galleryByMonthBtn">By Month</button>
          <button class="btn" id="galleryCampusBtn">Campus</button>
          <button class="btn" id="galleryAllBtn">All</button>
        </section>

        <section
          id="gallerySection"
          class="gallery-wrap"
          style="display: none; margin-top: 12px"
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 10px;
            "
          >
            <div style="font-weight: 900; color: #fff">Museum Gallery</div>
            <div style="color: var(--muted); font-size: 13px">
              Square cubicles • click to open
            </div>
          </div>
          <div id="gallery" class="gallery" aria-live="polite"></div>
        </section>
      </main>

      <aside
        id="pinnedColumn"
        class="pinned-column hidden"
        aria-label="Pinned events"
      >
        <div
          class="panel-top"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <strong style="font-size: 14px; color: var(--text-dark)"
            >Pinned</strong
          >
          <div style="display: flex; gap: 6px">
            <button id="exportPins" class="btn" title="Export pinned">
              Export
            </button>
            <button id="clearPins" class="btn" title="Clear pins">Clear</button>
            <button id="pinCollapseBtn" class="btn" title="Collapse panel">
              Hide
            </button>
          </div>
        </div>

        <div id="pinsList" style="margin-top: 10px"></div>
        <div id="noPins" class="pin-empty" style="display: none">
          No pinned events — pin using the 📌 on a card
        </div>
      </aside>
    </div>

    <button id="pinnedToggleBtn" title="Open pinned events">📌</button>
    <button id="presentExit" class="btn" style="display: none">
      Exit Present
    </button>

    <!-- Present slide area (fullscreen slideshow) -->
    <div id="presentSlide" class="present-slide" aria-hidden="true">
      <div class="slide-inner">
        <button
          id="psPrev"
          class="btn"
          style="
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
          "
        >
          ◀
        </button>
        <div
          id="psContent"
          style="
            max-width: 1100px;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
          "
        ></div>
        <button
          id="psNext"
          class="btn"
          style="
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
          "
        >
          ▶
        </button>
        <div id="psCaption" class="slide-caption"></div>
      </div>
    </div>

    <!-- Lightbox -->
    <div
      id="lightbox"
      class="lightbox"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
    >
      <div class="lb-controls">
        <button id="lbPrev" aria-label="Previous">◀</button>
        <button id="lbNext" aria-label="Next">▶</button>
      </div>
      <div class="lb-inner" style="text-align: center; max-width: 95%">
        <img id="lbImage" alt="" />
        <div class="lb-caption" id="lbCaption"></div>
        <div style="margin-top: 12px">
          <button id="lbClose" class="btn">Close</button>
        </div>
      </div>
    </div>

    <script>
      /* =========================
   Data & assets
   ========================= */
      const HERO =
        "https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/04/VideoCover-1.jpeg?resize=767%2C500&ssl=1";

      /* Events list (kept complete) */
      const EVENTS = [
        { name: "Summer Holiday", start: "2025-08-01", end: "2025-08-09" },
        {
          name: "School Opening (Arrival & Dorm Move-in)",
          start: "2025-08-10",
          end: "2025-08-11",
        },
        { name: "First Semester Registration", start: "2025-08-11" },
        { name: "Orientation", start: "2025-08-12" },
        { name: "Faculty Family", start: "2025-09-07" },
        { name: "Picture Day", start: "2025-09-09" },
        { name: "Open Weekend", start: "2025-09-12", end: "2025-09-14" },
        { name: "Week of Prayer", start: "2025-09-15", end: "2025-09-20" },
        { name: "Camping Trip", start: "2025-09-21", end: "2025-09-23" },
        { name: "Online Parent-Teacher Conferences", start: "2025-09-30" },
        { name: "Midterm Break", start: "2025-10-09", end: "2025-10-20" },
        { name: "Music Sabbath", start: "2025-10-25" },
        {
          name: "Weekend of Spiritual Emphasis",
          start: "2025-11-07",
          end: "2025-11-08",
        },
        { name: "MAP Testing", start: "2025-11-24", end: "2025-11-27" },
        { name: "Faculty Family", start: "2025-11-14" },
        { name: "Finals Review Week", start: "2025-12-01", end: "2025-12-05" },
        { name: "Final Exams 1st Sem", start: "2025-12-08", end: "2025-12-10" },
        { name: "Christmas Break", start: "2025-12-10", end: "2026-01-05" },
        { name: "School Opening (2nd Sem)", start: "2026-01-05" },
        {
          name: "Senior Government Day",
          start: "2026-01-20",
          end: "2026-01-21",
        },
        { name: "Faculty Family", start: "2026-01-30" },
        { name: "Junior Vespers", start: "2026-02-06" },
        { name: "NHS Applications Deadline", start: "2026-02-10" },
        {
          name: "Weekend of Spiritual Emphasis",
          start: "2026-02-13",
          end: "2026-02-14",
        },
        { name: "ACT", start: "2026-02-13" },
        { name: "NHS Induction", start: "2026-02-17" },
        { name: "Mt. Kenya Trip", start: "2026-02-20", end: "2026-02-24" },
        { name: "Senior Dedication", start: "2026-02-27" },
        { name: "Sophomore Vespers", start: "2026-03-06" },
        {
          name: "Student-Led Week of Prayer",
          start: "2026-03-09",
          end: "2026-03-14",
        },
        { name: "Track and Field", start: "2026-03-19", end: "2026-03-20" },
        { name: "Chorale Sacred Concert", start: "2026-03-21" },
        { name: "Senior Class Trip", start: "2026-03-23", end: "2026-03-26" },
        { name: "Midterm Break", start: "2026-03-26", end: "2026-04-06" },
        {
          name: "Ethiopia Mission Trip",
          start: "2026-03-26",
          end: "2026-04-05",
        },
        { name: "ACT", start: "2026-04-10" },
        { name: "Freshmen Vespers", start: "2026-04-17" },
        { name: "Faculty Family", start: "2026-04-19" },
        { name: "Week of Prayer", start: "2026-04-20", end: "2026-04-25" },
        { name: "Long Weekend", start: "2026-04-30", end: "2026-05-03" },
        { name: "ASB Spirit Week", start: "2026-05-04", end: "2026-05-09" },
        { name: "Class Surveys", start: "2026-05-11", end: "2026-05-13" },
        { name: "ASB Elections", start: "2026-05-12" },
        { name: "Spring Concert", start: "2026-05-16" },
        { name: "MAP Testing", start: "2026-05-18", end: "2026-05-21" },
        { name: "Dorm Parties", start: "2026-05-23" },
        { name: "Dorm Outings", start: "2026-05-24" },
        { name: "Finals Review Week", start: "2026-05-25", end: "2026-05-29" },
        { name: "Zamani Night", start: "2026-05-30" },
        { name: "Elementary Graduation", start: "2026-05-31" },
        { name: "Final Exams 2nd Sem", start: "2026-06-02", end: "2026-06-04" },
        { name: "GRADDDDD!!!!", start: "2026-06-05", end: "2026-06-07" },
      ];

      const MONTH_COLORS = {
        "01": "#e74c3c",
        "02": "#ff8a65",
        "03": "#f6c85f",
        "04": "#8dd3c7",
        "05": "#66a3ff",
        "06": "#9b59b6",
        "07": "#f06292",
        "08": "#ffb84d",
        "09": "#6ab04c",
        10: "#4a90e2",
        11: "#34495e",
        12: "#7bdbdb",
      };

      /* museum photos (monthly) */
      const MUSEUM_PHOTOS = [
        {
          src: HERO,
          caption: "Maxwell — Campus View",
          month: "08",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1600&q=80&auto=format&fit=crop",
          caption: "Forest Path",
          month: "09",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1600&q=80&auto=format&fit=crop",
          caption: "Lake at Dawn",
          month: "10",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1503264116251-35a269479413?w=1600&q=80&auto=format&fit=crop",
          caption: "Foggy Ridge",
          month: "12",
          year: 2025,
        },
        {
          src: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1600&q=80&auto=format&fit=crop",
          caption: "Mountain Trail",
          month: "03",
          year: 2026,
        },
        {
          src: "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?w=1600&q=80&auto=format&fit=crop",
          caption: "Sunset Camp",
          month: "05",
          year: 2026,
        },
      ];

      /* CAMPUS photos - replaced first 4 with the URLs you gave */
      const CAMPUS_PHOTOS = [
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmV27Af6dGvJoR-LVUGmkCauwQepWKLwi7Zw&s",
          caption: "Campus 1",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTHDr-_KeMgIf8tN3PHxytKFN7lbUhaLuPpkQ&s",
          caption: "Campus 2",
        },
        {
          src: "https://static.wixstatic.com/media/b62f56_ce88667acf42430fbea4c12175730dd3.jpg/v1/fill/w_960,h_640,al_c,q_85,enc_avif,quality_auto/b62f56_ce88667acf42430fbea4c12175730dd3.jpg",
          caption: "Campus 3",
        },
        {
          src: "https://i0.wp.com/maxwellsda.org/wp-content/uploads/2025/03/EsoPheb.jpeg?fit=1400%2C1400&ssl=1",
          caption: "Campus 4",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwjR3VnDRD6LdSrblZYVliJaRRigcs-tRg1A&s",
          caption: "Campus 5",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_UAdf79fDLKoBvHdkMag3M7D2yQ_LqeaMfEHAc2SL3tjaM2YgYv7lnp03azSa0QtDdfs&usqp=CAU",
          caption: "Campus 6",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRSf7j4BoCP9Y4wsnOAPCmjaGtQ--w7biBxRWvnQXHA2_Jo0WCWdGmEeX5rB87zfhaWHQo&usqp=CAU",
          caption: "Campus 7",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQF4CttDiXRUIEdVk0US158Ob3-siokVF2RSppthCTBNSNtkbNshzNTVMTK0UxNVIqfpVc&usqp=CAU",
          caption: "Campus 8",
        },
        {
          src: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTLWlAao-P3ibqUPD9n0AmP5nHL0BzwrYsPMRD7yNfh0To0pjm4gfLZkDMCY2OoesrqEXo&usqp=CAU",
          caption: "Campus 9",
        },
      ];

      /* ---------------- helpers ---------------- */
      const $ = (id) => document.getElementById(id);
      const pad = (n) => (n < 10 ? "0" + n : String(n));
      const parseStart = (s) =>
        s.includes("T") ? new Date(s) : new Date(s + "T00:00:00");
      const parseEnd = (e, start) => {
        if (!e) {
          const d = new Date(start);
          d.setHours(23, 59, 59, 999);
          return d;
        }
        return e.includes("T") ? new Date(e) : new Date(e + "T23:59:59.999");
      };
      const formatISO = (d) =>
        `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
      const escapeHtml = (s) =>
        String(s || "").replace(
          /[&<>"]/g,
          (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c])
        );
      function eventIcon(name) {
        const n = (name || "").toLowerCase();
        if (/exam|final|test|act|map/.test(n)) return "📝";
        if (
          /break|holiday|christmas|spring|long weekend|summer|vacation/.test(n)
        )
          return "🎉";
        if (/trip|camp|mt|mountain|mission/.test(n)) return "🏕️";
        if (/concert|chorale|music/.test(n)) return "🎵";
        if (/sports|track|field/.test(n)) return "🏅";
        return "📅";
      }
      function formatDateBadge(start, end) {
        const s = parseStart(start);
        const e = end ? parseStart(end) : null;
        if (!e)
          return `${s.toLocaleString("en", { month: "short" })} ${s.getDate()}`;
        if (
          s.getFullYear() === e.getFullYear() &&
          s.getMonth() === e.getMonth()
        )
          return `${s.toLocaleString("en", {
            month: "short",
          })} ${s.getDate()}–${e.getDate()}`;
        return `${s.toLocaleString("en", {
          month: "short",
        })} ${s.getDate()} – ${e.toLocaleString("en", {
          month: "short",
        })} ${e.getDate()}`;
      }

      /* ---------------- pinned storage ---------------- */
      const PIN_KEY = "maxwell_pinned_v4";
      function getPinned() {
        try {
          return JSON.parse(localStorage.getItem(PIN_KEY) || "[]");
        } catch (e) {
          return [];
        }
      }
      function savePinned(arr) {
        localStorage.setItem(PIN_KEY, JSON.stringify(arr));
        renderPinnedPanel();
      }
      function togglePin(i) {
        const pins = getPinned();
        const p = pins.indexOf(i);
        if (p === -1) pins.unshift(i);
        else pins.splice(p, 1);
        savePinned(pins);
      }
      function isPinned(i) {
        return getPinned().includes(i);
      }

      /* ---------------- starfield ---------------- */
      (function initStars() {
        const c = document.createElement("canvas");
        c.id = "starsCanvas";
        c.style.position = "fixed";
        c.style.inset = "0";
        c.style.zIndex = "-1";
        c.style.pointerEvents = "none";
        document.body.appendChild(c);
        const ctx = c.getContext("2d");
        function r() {
          c.width = innerWidth;
          c.height = innerHeight;
        }
        window.addEventListener("resize", r);
        r();
        const stars = Array.from({ length: 120 }, () => ({
          x: Math.random() * c.width,
          y: Math.random() * c.height,
          r: Math.random() * 1.6 + 0.2,
          dy: Math.random() * 0.5 + 0.02,
          a: 0.2 + Math.random() * 0.6,
        }));
        function tick() {
          ctx.clearRect(0, 0, c.width, c.height);
          for (const s of stars) {
            ctx.globalAlpha =
              s.a * (0.7 + Math.sin(Date.now() / 1000 + s.x) * 0.3);
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
            ctx.fillStyle = "#ffffff";
            ctx.fill();
            s.y += s.dy;
            if (s.y > c.height + 10) {
              s.y = -10;
              s.x = Math.random() * c.width;
            }
          }
          requestAnimationFrame(tick);
        }
        tick();
      })();

      /* ---------------- rendering grid ---------------- */
      let items = [],
        tickHandle = null,
        mode = "grid",
        galleryFilter = "byMonth";
      function sortEvents() {
        EVENTS.sort((a, b) => parseStart(a.start) - parseStart(b.start));
      }
      function findNext() {
        const now = Date.now();
        return (
          EVENTS.find(
            (ev) => parseEnd(ev.end, parseStart(ev.start)).getTime() >= now
          ) || null
        );
      }
      function renderNextUp() {
        const n = findNext();
        const el = $("nextUp");
        if (!el) return;
        if (!n) {
          el.style.display = "none";
          return;
        }
        el.style.display = "";
        $("nextUpName").textContent = n.name;
        $("nextUpDetail").textContent = n.end
          ? `From ${formatISO(parseStart(n.start))} → ${formatISO(
              parseStart(n.end)
            )}`
          : `On ${formatISO(parseStart(n.start))}`;
      }

      /* update countdown/status for items array */
      function updateAllCountdowns(now) {
        if (!now) now = new Date();
        items.forEach((item) => {
          const { start, end, el } = item;
          const cd = el.querySelector(".countdown");
          const st = el.querySelector(".status");
          if (now.getTime() < start.getTime()) {
            el.classList.remove("happening", "finished");
            el.classList.add("upcoming");
            const diff = start.getTime() - now.getTime();
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            if (cd) cd.textContent = `${d}d ${h}h ${m}m ${s}s left`;
            if (st) st.textContent = "⏳ Coming soon";
          } else if (now.getTime() > end.getTime()) {
            el.classList.remove("upcoming", "happening");
            el.classList.add("finished");
            if (cd) cd.textContent = `Ended on ${formatISO(end)}`;
            if (st) st.textContent = "✅ Finished";
          } else {
            el.classList.remove("upcoming", "finished");
            el.classList.add("happening");
            const diff = end.getTime() - now.getTime();
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            if (cd) cd.textContent = `${d}d ${h}h ${m}m ${s}s remaining`;
            if (st) st.textContent = "🔴 Happening now";
          }
        });
        updatePinnedCounts(now);
      }

      /* render all events (grouped by month) */
      function renderAll() {
        if (tickHandle) clearInterval(tickHandle);
        items = [];
        const grid = $("eventsGrid");
        if (!grid) return;
        grid.innerHTML = "";
        sortEvents();
        renderNextUp();
        const q = ($("searchBox").value || "").toLowerCase();
        const monthFilter = $("monthFilter").value || "";
        let currentGroup = "";

        EVENTS.forEach((ev, idx) => {
          if (q && !ev.name.toLowerCase().includes(q)) return;
          if (monthFilter && ev.start.slice(5, 7) !== monthFilter) return;

          const start = parseStart(ev.start);
          const mmKey = `${start.getFullYear()}-${pad(start.getMonth() + 1)}`;
          if (mmKey !== currentGroup) {
            currentGroup = mmKey;
            const heading = document.createElement("div");
            heading.className = "month-heading";
            heading.textContent = `${start.toLocaleString("en", {
              month: "long",
            })} ${start.getFullYear()}`;
            heading.dataset.mm = pad(start.getMonth() + 1);
            heading.addEventListener("click", () => {
              $("monthFilter").value = heading.dataset.mm;
              renderAll();
            });
            grid.appendChild(heading);
          }

          const startDate = parseStart(ev.start);
          const endDate = parseEnd(ev.end, startDate);
          const id = idx;
          const monthColor =
            MONTH_COLORS[pad(startDate.getMonth() + 1)] || "#ccc";

          const card = document.createElement("article");
          card.className = "card fade-in";
          card.dataset.idx = String(id);
          card.innerHTML = `
      <div class="month-strip" style="background:${monthColor}"></div>
      <button class="pin-btn" aria-label="Pin event">📌</button>
      <div class="big-letter" aria-hidden="true">${
        ev.name && ev.name[0] ? ev.name[0].toUpperCase() : "E"
      }</div>
      <div class="title"><div class="text">${escapeHtml(ev.name)}</div></div>
      <div class="meta">${eventIcon(ev.name)} ${
            ev.end
              ? `${formatISO(startDate)} → ${formatISO(parseStart(ev.end))}`
              : formatISO(startDate)
          }</div>
      <div class="countdown">—</div>
      <div class="status">—</div>
      <div class="date-badge">${formatDateBadge(ev.start, ev.end)}</div>
    `;
          grid.appendChild(card);

          items.push({
            id,
            name: ev.name,
            start: startDate,
            end: endDate,
            el: card,
            idx,
          });

          // pin button wiring
          const pb = card.querySelector(".pin-btn");
          const refreshPin = () => pb.classList.toggle("active", isPinned(id));
          pb.addEventListener("click", (e) => {
            e.stopPropagation();
            togglePin(id);
            refreshPin();
          });
          refreshPin();

          enableSwipeToPin(card, id, pb);

          card.tabIndex = 0;
          card.addEventListener("keydown", (e) => {
            if (e.key === "Enter") card.click();
          });
          card.addEventListener("click", () => {
            card.style.boxShadow = "0 28px 88px rgba(255,180,60,0.14)";
            setTimeout(() => (card.style.boxShadow = ""), 900);
          });
        });

        tickHandle = setInterval(() => updateAllCountdowns(new Date()), 1000);
        updateAllCountdowns(new Date());
        renderPinnedPanel();
        updateYearProgress();
        if (mode === "museum") renderGallery();
        applyMode();
      }

      /* ---------------- pinned panel ---------------- */
      function renderPinnedPanel() {
        const container = $("pinnedColumn"),
          list = $("pinsList"),
          noPins = $("noPins"),
          pinnedToggle = $("pinnedToggleBtn");
        if (!container) return;
        const pins = getPinned();
        list.innerHTML = "";
        if (!pins || pins.length === 0) {
          container.classList.add("hidden");
          document.querySelector(".page").classList.add("pinned-hidden");
          noPins.style.display = "block";
          pinnedToggle.style.display = "none";
          return;
        }
        container.classList.remove("hidden");
        document.querySelector(".page").classList.remove("pinned-hidden");
        noPins.style.display = "none";
        pinnedToggle.style.display = container.classList.contains("hidden")
          ? "block"
          : "none";

        pins.forEach((i) => {
          const ev = EVENTS[i];
          if (!ev) return;
          const start = parseStart(ev.start);
          const chip = document.createElement("div");
          chip.className = "pinned-chip";
          chip.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="min-width:0">
          <div style="font-weight:800">${escapeHtml(ev.name)}</div>
          <div style="font-size:12px;color:#516c7f">${formatISO(start)}</div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn view">View</button>
          <button class="btn unpin">Unpin</button>
        </div>
      </div>
      <div style="margin-top:6px;display:flex;justify-content:space-between;align-items:center">
        <div class="mini" style="color:var(--accent)">—</div>
        <div style="width:40%"><div style="height:6px;background:rgba(2,8,23,0.06);border-radius:6px;overflow:hidden"><i style="display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));"></i></div></div>
      </div>
    `;
          chip.querySelector(".view").addEventListener("click", () => {
            const el = document.querySelector(`.card[data-idx="${i}"]`);
            if (el) {
              el.scrollIntoView({ behavior: "smooth", block: "center" });
              el.style.boxShadow = "0 28px 88px rgba(255,180,60,0.18)";
              setTimeout(() => (el.style.boxShadow = ""), 1200);
            }
          });
          chip.querySelector(".unpin").addEventListener("click", () => {
            togglePin(i);
          });
          list.appendChild(chip);
        });

        updatePinnedCounts(new Date());
      }

      /* update pinned chips mini counts/progress and pinnedToggle visibility */
      function updatePinnedCounts(now) {
        if (!now) now = new Date();
        const chips = Array.from(document.querySelectorAll(".pinned-chip"));
        chips.forEach((chip) => {
          const title = chip.querySelector("div > div > div").textContent;
          const pinned = getPinned();
          const idx = pinned.find((i) => EVENTS[i] && EVENTS[i].name === title);
          if (idx == null) return;
          const ev = EVENTS[idx];
          const start = parseStart(ev.start);
          const end = parseEnd(ev.end, start);
          const mini = chip.querySelector(".mini");
          const bar = chip.querySelector("i");
          if (now.getTime() < start.getTime()) {
            const diff = start.getTime() - now.getTime();
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            mini.textContent = `${d}d ${h}h`;
            if (bar) bar.style.width = "0%";
          } else if (now.getTime() > end.getTime()) {
            mini.textContent = "Finished";
            if (bar) bar.style.width = "100%";
          } else {
            const total = end.getTime() - start.getTime();
            const passed = total - (end.getTime() - now.getTime());
            const pct = Math.max(
              0,
              Math.min(100, Math.round((passed / total) * 100))
            );
            mini.textContent = `${Math.floor(
              (end.getTime() - now.getTime()) / 86400000
            )}d left`;
            if (bar) bar.style.width = pct + "%";
          }
        });

        const pinnedToggle = $("pinnedToggleBtn");
        const panel = $("pinnedColumn");
        if (
          getPinned().length > 0 &&
          panel &&
          panel.classList.contains("hidden")
        )
          pinnedToggle.style.display = "block";
        else pinnedToggle.style.display = "none";
      }

      /* ----------------- touch swipe to pin ----------------- */
      function enableSwipeToPin(card, idx, pinBtn) {
        let down = false,
          sx = 0,
          sy = 0,
          moved = false;
        function onDown(e) {
          down = true;
          sx = e.clientX;
          sy = e.clientY;
          moved = false;
          card.style.transition = "none";
        }
        function onMove(e) {
          if (!down) return;
          const dx = e.clientX - sx;
          const dy = e.clientY - sy;
          if (Math.abs(dx) > 8 && Math.abs(dx) > Math.abs(dy)) moved = true;
          if (moved)
            card.style.transform = `translateX(${Math.min(
              Math.max(dx, -80),
              80
            )}px)`;
        }
        function onUp(e) {
          if (!down) return;
          down = false;
          card.style.transition = "transform .18s";
          if (moved) {
            const dx = e.clientX - sx;
            if (dx > 60) {
              togglePin(idx);
              if (pinBtn) pinBtn.classList.add("active");
            } else if (dx < -60) {
              togglePin(idx);
              if (pinBtn) pinBtn.classList.remove("active");
            }
            setTimeout(() => (card.style.transform = ""), 200);
          } else {
            card.style.transform = "";
          }
          moved = false;
        }
        card.addEventListener("pointerdown", onDown);
        card.addEventListener("pointermove", onMove);
        card.addEventListener("pointerup", onUp);
        card.addEventListener("pointercancel", onUp);
      }

      /* ---------------- Gallery rendering ---------------- */
      function renderGallery() {
        const container = $("gallery");
        if (!container) return;
        container.innerHTML = "";
        if (galleryFilter === "campus") {
          CAMPUS_PHOTOS.forEach((p, i) => {
            const btn = document.createElement("button");
            btn.className = "cubicle";
            btn.innerHTML = `<img src="${p.src}" alt="${escapeHtml(
              p.caption
            )}"><div class="caption">${escapeHtml(p.caption)}</div>`;
            btn.addEventListener("click", () => openLightbox(CAMPUS_PHOTOS, i));
            container.appendChild(btn);
          });
          return;
        }
        const photos =
          galleryFilter === "all"
            ? [...MUSEUM_PHOTOS, ...CAMPUS_PHOTOS]
            : [...MUSEUM_PHOTOS];
        if (galleryFilter === "byMonth") {
          const months = new Map();
          photos.forEach((p) => {
            const key = p.month
              ? `${p.year}-${p.month}`
              : `zz-${Math.random()}`;
            if (!months.has(key))
              months.set(key, {
                month: p.month || "",
                year: p.year || "",
                photos: [],
              });
            months.get(key).photos.push(p);
          });
          Array.from(months.entries())
            .sort()
            .forEach(([k, group]) => {
              if (group.month) {
                const heading = document.createElement("div");
                heading.className = "month-heading";
                heading.textContent = `${new Date(
                  group.year + "-" + group.month + "-01"
                ).toLocaleString("en", { month: "long", year: "numeric" })}`;
                heading.addEventListener("click", () => {
                  $("monthFilter").value = group.month;
                  renderAll();
                });
                container.appendChild(heading);
              }
              group.photos.forEach((p, i) => {
                const btn = document.createElement("button");
                btn.className = "cubicle";
                btn.innerHTML = `<img src="${p.src}" alt="${escapeHtml(
                  p.caption
                )}"><div class="caption">${escapeHtml(p.caption)}</div>`;
                btn.addEventListener("click", () =>
                  openLightbox(group.photos, i)
                );
                container.appendChild(btn);
              });
            });
        } else {
          photos.forEach((p, i) => {
            const btn = document.createElement("button");
            btn.className = "cubicle";
            btn.innerHTML = `<img src="${p.src}" alt="${escapeHtml(
              p.caption
            )}"><div class="caption">${escapeHtml(p.caption)}</div>`;
            btn.addEventListener("click", () => openLightbox(photos, i));
            container.appendChild(btn);
          });
        }
      }

      /* ---------------- Lightbox ---------------- */
      let lbPhotos = [],
        lbIndex = 0;
      function openLightbox(photos, idx) {
        lbPhotos = photos;
        lbIndex = idx;
        $("lbImage").src = photos[idx].src;
        $("lbImage").alt = photos[idx].caption || "";
        $("lbCaption").textContent = photos[idx].caption || "";
        $("lightbox").classList.add("open");
        $("lightbox").setAttribute("aria-hidden", "false");
      }
      function closeLightbox() {
        $("lightbox").classList.remove("open");
        $("lightbox").setAttribute("aria-hidden", "true");
        $("lbImage").src = "";
      }
      function lbNext() {
        if (!lbPhotos.length) return;
        lbIndex = (lbIndex + 1) % lbPhotos.length;
        $("lbImage").src = lbPhotos[lbIndex].src;
        $("lbCaption").textContent = lbPhotos[lbIndex].caption || "";
      }
      function lbPrev() {
        if (!lbPhotos.length) return;
        lbIndex = (lbIndex - 1 + lbPhotos.length) % lbPhotos.length;
        $("lbImage").src = lbPhotos[lbIndex].src;
        $("lbCaption").textContent = lbPhotos[lbIndex].caption || "";
      }
      $("lbNext").addEventListener("click", lbNext);
      $("lbPrev").addEventListener("click", lbPrev);
      $("lbClose").addEventListener("click", closeLightbox);
      document.addEventListener("keydown", (e) => {
        if ($("lightbox").classList.contains("open")) {
          if (e.key === "Escape") closeLightbox();
          if (e.key === "ArrowRight") lbNext();
          if (e.key === "ArrowLeft") lbPrev();
        }
      });
      $("lightbox").addEventListener("click", (e) => {
        if (e.target === $("lightbox")) closeLightbox();
      });

      /* ---------------- Present slideshow (auto-play) ---------------- */
      let slideshowTimer = null,
        slideshowIndex = 0,
        slideshowArray = [],
        slideshowMode = "gallery"; // 'gallery' or 'pinned'
      const SLIDE_DELAY = 3500;

      function buildSlideshowArray() {
        if (mode === "museum") {
          if (galleryFilter === "campus") return CAMPUS_PHOTOS.slice();
          if (galleryFilter === "all")
            return [...MUSEUM_PHOTOS, ...CAMPUS_PHOTOS];
          // byMonth
          return MUSEUM_PHOTOS.slice();
        } else {
          // grid mode: build array from pinned events if any
          const pins = getPinned();
          if (pins.length === 0) {
            // fallback to museum images
            return MUSEUM_PHOTOS.slice();
          }
          // create pseudo-photo objects representing pinned events
          return pins.map((i) => ({ title: EVENTS[i].name, idx: i }));
        }
      }

      function showSlide(idx) {
        const container = $("psContent");
        const caption = $("psCaption");
        container.innerHTML = "";
        caption.textContent = "";
        const item = slideshowArray[idx];
        if (!item) return;
        // if image-like object (has src) show img; else show a big event card for pinned events
        if (item.src) {
          const img = document.createElement("img");
          img.src = item.src;
          img.alt = item.caption || "";
          container.appendChild(img);
          caption.textContent = item.caption || "";
        } else if (item.title) {
          // pinned event pseudo-slide
          const ev = EVENTS[item.idx];
          const big = document.createElement("div");
          big.style.width = "820px";
          big.style.height = "480px";
          big.style.borderRadius = "12px";
          big.style.background = "linear-gradient(180deg,#fff,#f6f9ff)";
          big.style.color = "var(--text-dark)";
          big.style.display = "flex";
          big.style.flexDirection = "column";
          big.style.justifyContent = "center";
          big.style.alignItems = "flex-start";
          big.style.padding = "40px";
          big.style.boxShadow = "0 40px 140px rgba(0,0,0,0.6)";
          const title = document.createElement("div");
          title.style.fontSize = "36px";
          title.style.fontWeight = "900";
          title.style.marginBottom = "12px";
          title.textContent = ev.name;
          const date = document.createElement("div");
          date.style.fontSize = "18px";
          date.style.fontWeight = "700";
          date.style.marginBottom = "8px";
          const s = parseStart(ev.start);
          const e = ev.end ? parseStart(ev.end) : null;
          date.textContent = e
            ? `${formatISO(s)} → ${formatISO(e)}`
            : `${formatISO(s)}`;
          const status = document.createElement("div");
          status.style.fontSize = "16px";
          status.style.fontWeight = "800";
          // compute live status
          const now = new Date();
          const end = parseEnd(ev.end, s);
          if (now.getTime() < s.getTime())
            status.textContent = "⏳ Coming soon";
          else if (now.getTime() > end.getTime())
            status.textContent = "✅ Finished";
          else status.textContent = "🔴 Happening now";
          big.appendChild(title);
          big.appendChild(date);
          big.appendChild(status);
          container.appendChild(big);
          caption.textContent = ev.name;
        } else {
          // fallback show hero image
          const img = document.createElement("img");
          img.src = HERO;
          container.appendChild(img);
        }
      }

      function startSlideshow(source = "gallery") {
        // build array based on current mode and galleryFilter or pinned
        slideshowMode = source;
        if (source === "pinned") {
          const pins = getPinned();
          if (!pins || pins.length === 0) {
            // fallback to gallery
            slideshowArray = buildSlideshowArray();
          } else {
            slideshowArray = pins.map((i) => ({
              title: EVENTS[i].name,
              idx: i,
            }));
          }
        } else {
          slideshowArray = buildSlideshowArray();
        }
        if (slideshowArray.length === 0) return;
        slideshowIndex = 0;
        showSlide(slideshowIndex);
        $("presentSlide").classList.add("open");
        $("presentSlide").setAttribute("aria-hidden", "false");
        // auto advance
        stopSlideshow();
        slideshowTimer = setInterval(() => {
          slideshowIndex = (slideshowIndex + 1) % slideshowArray.length;
          showSlide(slideshowIndex);
        }, SLIDE_DELAY);
      }

      function stopSlideshow() {
        if (slideshowTimer) {
          clearInterval(slideshowTimer);
          slideshowTimer = null;
        }
        $("presentSlide").classList.remove("open");
        $("presentSlide").setAttribute("aria-hidden", "true");
      }

      /* present enter/exit */
      function enterPresent() {
        // if already present, do nothing
        if (document.body.classList.contains("present-mode")) return;
        document.body.classList.add("present-mode");
        $("presentExit").style.display = "";
        // choose slideshow source: if in museum, show gallery; if in grid and there are pins, use pinned
        const source =
          mode === "museum"
            ? "gallery"
            : getPinned().length
            ? "pinned"
            : "gallery";
        startSlideshow(source);
      }

      function exitPresent() {
        document.body.classList.remove("present-mode");
        $("presentExit").style.display = "none";
        stopSlideshow();
      }

      /* slideshow controls */
      $("psNext").addEventListener("click", () => {
        if (slideshowArray.length === 0) return;
        slideshowIndex = (slideshowIndex + 1) % slideshowArray.length;
        showSlide(slideshowIndex);
        resetSlideshowTimer();
      });
      $("psPrev").addEventListener("click", () => {
        if (slideshowArray.length === 0) return;
        slideshowIndex =
          (slideshowIndex - 1 + slideshowArray.length) % slideshowArray.length;
        showSlide(slideshowIndex);
        resetSlideshowTimer();
      });
      function resetSlideshowTimer() {
        if (slideshowTimer) {
          clearInterval(slideshowTimer);
          slideshowTimer = setInterval(() => {
            slideshowIndex = (slideshowIndex + 1) % slideshowArray.length;
            showSlide(slideshowIndex);
          }, SLIDE_DELAY);
        }
      }

      /* pause on hover */
      $("presentSlide").addEventListener("mouseenter", () => {
        if (slideshowTimer) clearInterval(slideshowTimer);
      });
      $("presentSlide").addEventListener("mouseleave", () => {
        if (slideshowArray.length)
          slideshowTimer = setInterval(() => {
            slideshowIndex = (slideshowIndex + 1) % slideshowArray.length;
            showSlide(slideshowIndex);
          }, SLIDE_DELAY);
      });

      /* keyboard for slideshow */
      document.addEventListener("keydown", (e) => {
        if (document.body.classList.contains("present-mode")) {
          if (e.key === "ArrowRight") {
            slideshowIndex = (slideshowIndex + 1) % slideshowArray.length;
            showSlide(slideshowIndex);
            resetSlideshowTimer();
          }
          if (e.key === "ArrowLeft") {
            slideshowIndex =
              (slideshowIndex - 1 + slideshowArray.length) %
              slideshowArray.length;
            showSlide(slideshowIndex);
            resetSlideshowTimer();
          }
          if (e.key === "Escape") exitPresent();
        }
      });

      /* ---------------- modes & UI wiring ---------------- */
      function applyMode() {
        // style buttons
        $("gridBtn").classList.toggle("primary", mode === "grid");
        $("museumBtn").classList.toggle("primary", mode === "museum");
        // show/hide gallery area
        const gallerySection = $("gallerySection"),
          stage = $("stage");
        if (mode === "museum") {
          gallerySection.style.display = "";
          stage.style.display = "none";
          renderGallery();
        } else {
          gallerySection.style.display = "none";
          stage.style.display = "";
          stopSlideshow();
        }
      }

      /* gallery mode buttons */
      $("galleryByMonthBtn").addEventListener("click", () => {
        galleryFilter = "byMonth";
        if (mode !== "museum") mode = "museum";
        applyMode();
        renderGallery();
      });
      $("galleryCampusBtn").addEventListener("click", () => {
        galleryFilter = "campus";
        if (mode !== "museum") mode = "museum";
        applyMode();
        renderGallery();
      });
      $("galleryAllBtn").addEventListener("click", () => {
        galleryFilter = "all";
        if (mode !== "museum") mode = "museum";
        applyMode();
        renderGallery();
      });

      /* present button & exit */
      $("presentBtn").addEventListener("click", () => {
        enterPresent();
      });
      $("presentExit").addEventListener("click", () => {
        exitPresent();
      });

      /* other UI wiring */
      function wireUI() {
        $("heroImg").src = HERO;
        $("heroImg").crossOrigin = "anonymous";
        $("gridBtn").addEventListener("click", () => {
          mode = "grid";
          applyMode();
        });
        $("museumBtn").addEventListener("click", () => {
          mode = "museum";
          applyMode();
        });
        $("searchBox").addEventListener("input", () => renderAll());
        $("monthFilter").addEventListener("change", () => {
          renderAll();
        });

        $("clearPins").addEventListener("click", () => savePinned([]));
        $("exportPins").addEventListener("click", () => {
          const pins = getPinned();
          const rows = [["name", "start", "end"]];
          pins.forEach((i) => {
            if (EVENTS[i])
              rows.push([
                EVENTS[i].name || "",
                EVENTS[i].start || "",
                EVENTS[i].end || "",
              ]);
          });
          const csv = rows
            .map((r) =>
              r.map((c) => `"${String(c).replace(/"/g, '""')}"`).join(",")
            )
            .join("\n");
          const blob = new Blob([csv], { type: "text/csv" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "pinned.csv";
          a.click();
          URL.revokeObjectURL(url);
        });
        $("pinCollapseBtn").addEventListener("click", () => {
          const p = $("pinnedColumn");
          if (!p) return;
          p.classList.toggle("hidden");
          document
            .querySelector(".page")
            .classList.toggle("pinned-hidden", p.classList.contains("hidden"));
          updatePinnedCounts(new Date());
        });

        $("pinnedToggleBtn").addEventListener("click", () => {
          const p = $("pinnedColumn");
          if (!p) return;
          p.classList.remove("hidden");
          document.querySelector(".page").classList.remove("pinned-hidden");
          $("pinnedToggleBtn").style.display = "none";
        });
        // show pinned toggle when appropriate handled in updatePinnedCounts

        // lightbox controls already wired earlier
        $("lbNext").addEventListener("click", () => lbNext());
        $("lbPrev").addEventListener("click", () => lbPrev());

        // keyboard shortcuts
        document.addEventListener("keydown", (e) => {
          if (e.key.toLowerCase() === "p" && !e.ctrlKey && !e.metaKey) {
            const p = $("pinnedColumn");
            if (!p) return;
            if (getPinned().length === 0) return;
            if (p.classList.contains("hidden")) {
              p.classList.remove("hidden");
              document.querySelector(".page").classList.remove("pinned-hidden");
            } else {
              p.classList.add("hidden");
              document.querySelector(".page").classList.add("pinned-hidden");
            }
            updatePinnedCounts(new Date());
          }
          if (e.key === "Escape") {
            if (document.body.classList.contains("present-mode")) exitPresent();
          }
        });

        // clicking outside pinned hides it (desktop)
        document.addEventListener("click", (ev) => {
          const p = $("pinnedColumn");
          if (!p) return;
          if (p.classList.contains("hidden")) return;
          if (window.innerWidth <= 900) return;
          const target = ev.target;
          const toggleBtn = $("pinnedToggleBtn");
          if (
            !p.contains(target) &&
            target !== toggleBtn &&
            !target.closest(".pin-btn")
          ) {
            p.classList.add("hidden");
            document.querySelector(".page").classList.add("pinned-hidden");
            updatePinnedCounts(new Date());
          }
        });
      }

      /* ---------------- small helpers ---------------- */
      function updateYearProgress() {
        if (EVENTS.length === 0) return;
        const start = parseStart(EVENTS[0].start);
        const last = EVENTS[EVENTS.length - 1];
        const end = parseEnd(last.end, parseStart(last.start));
        const now = new Date();
        const total = end.getTime() - start.getTime();
        const passed = Math.max(
          0,
          Math.min(total, now.getTime() - start.getTime())
        );
        const pct = Math.round((passed / total) * 100);
        $("yearProgressBar").style.width = pct + "%";
      }

      /* accent sampling (optional) */
      async function sampleAccent() {
        const img = $("heroImg");
        if (!img) return;
        await new Promise((r) => {
          if (img.complete) return r();
          img.addEventListener("load", r, { once: true });
          img.addEventListener("error", r, { once: true });
        });
        try {
          const w = Math.min(img.naturalWidth || 200, 160),
            h = Math.min(img.naturalHeight || 120, 120);
          const canvas = document.createElement("canvas");
          canvas.width = w;
          canvas.height = h;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, w, h);
          const data = ctx.getImageData(0, 0, w, h).data;
          let r = 0,
            g = 0,
            b = 0,
            c = 0;
          for (let i = 0; i < data.length; i += 4) {
            const a = data[i + 3];
            if (a < 80) continue;
            r += data[i];
            g += data[i + 1];
            b += data[i + 2];
            c++;
          }
          if (c === 0) throw new Error("no pixels");
          r = Math.round(r / c);
          g = Math.round(g / c);
          b = Math.round(b / c);
          document.documentElement.style.setProperty(
            "--accent",
            `rgb(${r},${g},${b})`
          );
        } catch (e) {}
      }

      /* ---------------- bootstrap ---------------- */
      function init() {
        wireUI();
        sampleAccent();
        renderAll();
        updatePinnedCounts(new Date());
      }

      /* quick utilities for slideshow source selection in present mode (exposed via keyboard) */
      document.addEventListener("keydown", (e) => {
        if (document.body.classList.contains("present-mode")) {
          if (e.key === "g") {
            // switch to gallery slides (g)
            startSlideshow("gallery");
          }
          if (e.key === "i") {
            // switch to pinned slides (i)
            startSlideshow("pinned");
          }
        }
      });

      /* hook presentSlide next/prev to also reset timer */
      $("psNext").addEventListener("click", () => resetSlideshowTimer());
      $("psPrev").addEventListener("click", () => resetSlideshowTimer());

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
